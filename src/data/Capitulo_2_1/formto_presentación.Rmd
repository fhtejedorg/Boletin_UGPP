---
title: "Informe Mensual de las cotizaciones"
author: "Unidad de Gestión Pensional y Parafiscales - UGPP"
date: "Periodo -Noviembre de 2021"
output:
  html_document:
    toc: yes
    toc_float : yes
    theme: yeti
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#knitr::opts_chunk$set(fig.width = 5, fig.asp = 1 / 3)
```

<center>![](D:/Resultados_IMC/Presentaciones/logoUGPP.jfif)</center>

# Proposito del informe

- Contar con información detallada sobre la evolución de los aportes a seguridad social de los colombianos, como insumo fundamental para la toma de decisiones de política pública. 

- Identificar el comportamiento de empresas y personas naturales frente a la crisis, y evidenciar grupos poblacionales vulnerables. 

- Generar esquemas de relación diferenciada de la UGPP con los aportantes, reconociendo su realidad particular.

# Consideraciones técnicas

- La información presenta dos desagregaciones temáticas: cotizantes independientes y dependientes. Así mismo, hace énfasis en los dependientes de sector privado, donde se usa una base construida por la UGPP de entidades y empresas públicas, con información pública: SECOP, DATOS.GOV, Entidades Territoriales, Base de empresas DIAN (ENVIADA MIN HACIENDA), y los tipos de afiliación 1 (dependiente), 2 (servicio doméstico) y 22 (profesor particular).

- Los montos de cotización son la suma de los aportes de pensiones, salud, ARL, CCF, parafiscales SENA y ICBF en cada relación laboral. 

- La actividad económica se toma de la actualización más reciente del Registro Único Tributario – RUT. Cuando no es posible el cruce con RUT, se toma información de actividad económica de PILA.

- La información de ubicación de las personas se toma de la Caja de Compensación familiar y la información de fecha de nacimiento y sexo se toma de la base de RUAF a la fecha de corte de publicación 

# Introcucción
## Año tipo 2012 - 2019

### Estimación interanual de las cotizaciones

![](D:/Resultados_IMC/Presentaciones/año_tipo3.jpg)

### Estimación de los cotizantes en cada Enero para la estimación.

El IEM esta en función del número de cotizantes para el periodo de enero de cada año, ante esto es indispensable contar con la estimación de las cotizaciones para enero de 2021 con el fin de conocer el total esperado para cada mes de este año. 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 7, fig.width = 12}
library(car)
library(forecast)
library(tseries)
library(ggfortify)
library(xlsx)
library(dplyr)
library(tidyverse)
library(DT)
library(kableExtra)
library(knitr)
library(devtools)
library(ggpubr)
library(grid)
library(lattice)

Serie_completa<-read.csv2("D:/CONSULTORIAS/UGPP/2022/Proyectos/Boletin_UGPP/data/processed/Serie_cotizantes.csv")
Serie_total_ts<-ts(c(Serie_completa[Serie_completa$Year %in% c(2015,2016,2017,2018,2019),"Tot_cotizantes"],Serie_completa[Serie_completa$Year == 2020   & Serie_completa$Mes == 1,"Tot_cotizantes"]),start = c(2015,1), frequency = 12)
modelo_ser_tot<-auto.arima(Serie_total_ts,stepwise = FALSE,approximation = FALSE)
pronostico_total<-forecast(modelo_ser_tot,level = c(95),h = 15)
serie_total_pro_tot<-autoplot(pronostico_total, ts.colout = "black",predict.colour = 'grey50',predict.linetype = 'dashed',conf.int.colour = "#7FFF00" )+
  labs(title = "Serie de cotizantes", x = "Años ", y = "Total cotizantes")+theme_minimal()

Serie_total_ts_dep<-ts(c(Serie_completa[Serie_completa$Year %in% c(2015,2016,2017,2018,2019),"Cot_dependientes"],Serie_completa[Serie_completa$Year == 2020 & Serie_completa$Mes == 1,"Cot_dependientes"]),start = c(2015,1), frequency = 12)
modelo_ser_dep<-auto.arima(Serie_total_ts_dep,stepwise = FALSE,approximation = FALSE)
pronostico_dep<-forecast(modelo_ser_dep,level = c(95),h = 15)
  serie_total_pro_dep<-autoplot(pronostico_dep, predict.colour = 'blue', ts.colour = "blue",predict.linetype = 'dashed',conf.int.colour = "#7FFF00" )+
  labs(title = "Serie de cotizantes",subtitle = "Cotizantes dependientes", x = "Años ", y = "Total cotizantes")+theme_minimal()

Serie_total_ts_ind<-ts(c(Serie_completa[Serie_completa$Year %in% c(2014,2015,2016,2017,2018,2019),"Cot_independientes"],Serie_completa[Serie_completa$Year == 2020   & Serie_completa$Mes == 1,"Cot_independientes"]),start = c(2014,1), frequency = 12)
modelo_ser_ind<-auto.arima(Serie_total_ts_ind,stepwise = FALSE,approximation = FALSE)
pronostico_ind<-forecast(modelo_ser_ind,level = c(95),h = 15)
serie_total_pro_ind<-autoplot(pronostico_ind, predict.colour = 'darkred', ts.colour = "red",predict.linetype = 'dashed',conf.int.colour = "#7FFF00" )+
  labs(title = "Serie de cotizantes",subtitle = "Cotizantes independientes", x = "Años ", y = "Total cotizantes")+theme_minimal()

tabla0_2<- data.frame(c("2.018","2.019","2.020","2.021"),
                      c(formatC(9171320/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),formatC(9361354/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),formatC(9634045/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),
                        paste0(formatC(9980334/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1)," (",formatC(9313716/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),")")),
                      c(paste0(2.42,"%"),paste0(2.07,"%"),paste0(2.91,"%"),paste0(2.83,"%")),
                      c(formatC(2037402/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),formatC(1998738/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),formatC(2042867/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),
                        paste0(formatC(2129681/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1)," (",formatC(2044477/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),")")),
                      c(paste0(8.22,"%"),paste0(-1.9,"%"),paste0(2.21,"%"),paste0(4.25,"%")),
                      c(formatC(11208722/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),formatC(11360092/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),formatC(11676912/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),
                        paste0(formatC(11993732/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1)," (",formatC(11358193/1000,format = "f",big.mark = ".", decimal.mark = ",",digits = 1),")")),
                      c(paste0(3.43,"%"),paste0(1.35,"%"),paste0(2.79,"%"),paste0(2.71,"%"))); colnames(tabla0_2)<- c("Año","Cot.Dependientes","Var anual","Cot.Independientes","Var anual","Total_Cotizantes","Var anual")
tabla0_2_1<-ggtexttable(tabla0_2,rows = NULL,cols  = c("Año","Cot. Dependientes", "Var anual","Cot. Independientes","Var anual","Total cotizantes","Var anual"),theme = ttheme("light"))

ggarrange(tabla0_2_1,ggarrange(serie_total_pro_dep,serie_total_pro_ind,serie_total_pro_tot,ncol = 3),nrow = 2,heights = c(0.8,2))
```

## Total cotizantes

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 5, fig.width = 16}

#estimado de cotizantes 2021 Enero 12.403.028, lim_inf 12.093.822 y lim_sup 12.712.234
#estimado de cotizantes 2022 Enero 12.785.428, lim_inf 12.094.021 y lim_sup 13.476.835
library(xlsx)
library(dplyr)
library(tidyverse)
library(DT)
library(kableExtra)
library(knitr)
library(ggpubr)
library(ggplot2)

datos_tipo<-read.xlsx("D:/Nuevos_Insumos_IMC/Insumos_general_presentacion.xlsx",sheetName = "type_year")
informacion9_12_21<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC9_12_2021.csv")
informacion5_8_21<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC5_8_2021.csv")
informacion1_4_21<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC1_4_2021.csv")
informacion9_12_20<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC9_12_2020.csv")
informacion5_8_20<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC5_8_2020.csv")
informacion1_4_20<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC1_4_2020.csv")
informacion9_12_19<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC9_12_2019.csv")
informacion5_8_19<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC5_8_2019.csv")
informacion1_4_19<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC1_4_2019.csv")
informacion9_12_18<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC9_12_2018.csv")
informacion5_8_18<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC5_8_2018.csv")
informacion1_4_18<-read.csv2("../../../data/raw/Salidas_generales_rangoIBC1_4_2018.csv")

independientes<-rbind(data.frame(informacion9_12_21%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion5_8_21%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion1_4_21%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion9_12_20%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion5_8_20%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion1_4_20%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion9_12_19%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion5_8_19%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion1_4_19%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion9_12_18%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion5_8_18%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))),
                      data.frame(informacion1_4_18%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(Total_ind = sum(Total_relaciones_laborales,na.rm = TRUE))))
dependientes<-rbind(data.frame(informacion9_12_21%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion5_8_21%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion1_4_21%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion9_12_20%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion5_8_20%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion1_4_20%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion9_12_19%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion5_8_19%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion1_4_19%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion9_12_18%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion5_8_18%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion1_4_18%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(Total_dep = sum(Total_relaciones_laborales,na.rm = TRUE))))
Dep_sec_priv<-rbind(data.frame(informacion9_12_21%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion5_8_21%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion1_4_21%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion9_12_20%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion5_8_20%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion1_4_20%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion9_12_19%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion5_8_19%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion1_4_19%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion9_12_18%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion5_8_18%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))),
                    data.frame(informacion1_4_18%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(Total_sec_priv = sum(Total_relaciones_laborales,na.rm = TRUE))))

consolidado_tot<-merge(independientes,dependientes, by = c("YEAR","MONTH"), all = TRUE)
consolidado_tot<-merge(consolidado_tot,Dep_sec_priv, by = c("YEAR","MONTH"), all = TRUE)
consolidado_tot$TOTAL_COT<-consolidado_tot$Total_ind+consolidado_tot$Total_dep
consolidado_tot<-consolidado_tot[order(consolidado_tot$YEAR,consolidado_tot$MONTH),]
consolidado_tot$var_anual_tot<-rep(0,nrow(consolidado_tot))
consolidado_tot$var_mensual_tot<-rep(0,nrow(consolidado_tot))
consolidado_tot$var_anual_ind<-rep(0,nrow(consolidado_tot))
consolidado_tot$var_mensual_ind<-rep(0,nrow(consolidado_tot))
consolidado_tot$var_anual_dep<-rep(0,nrow(consolidado_tot))
consolidado_tot$var_mensual_dep<-rep(0,nrow(consolidado_tot))
consolidado_tot$var_anual_dep_sec_priv<-rep(0,nrow(consolidado_tot))
consolidado_tot$var_mensual_dep_sec_priv<-rep(0,nrow(consolidado_tot))

for(p in 2:nrow(consolidado_tot)){
  consolidado_tot$var_mensual_tot[p]<-(consolidado_tot$TOTAL_COT[p]-consolidado_tot$TOTAL_COT[(p-1)])/(consolidado_tot$TOTAL_COT[(p-1)])
  consolidado_tot$var_mensual_ind[p]<-(consolidado_tot$Total_ind[p]-consolidado_tot$Total_ind[(p-1)])/(consolidado_tot$Total_ind[(p-1)])
  consolidado_tot$var_mensual_dep[p]<-(consolidado_tot$Total_dep[p]-consolidado_tot$Total_dep[(p-1)])/(consolidado_tot$Total_dep[(p-1)])
  consolidado_tot$var_mensual_dep_sec_priv[p]<-(consolidado_tot$Total_sec_priv[p]-consolidado_tot$Total_sec_priv[(p-1)])/(consolidado_tot$Total_sec_priv[(p-1)])
}
#actualizar con 2022
for(y in c(2019,2020,2021)){
  for(m in 1:12){
    consolidado_tot[consolidado_tot$YEAR == y   & consolidado_tot$MONTH == m,"var_anual_tot"]<-(consolidado_tot[consolidado_tot$YEAR == y   & consolidado_tot$MONTH == m,"TOTAL_COT"]-consolidado_tot[consolidado_tot$YEAR == (y-1)   & consolidado_tot$MONTH == m,"TOTAL_COT"])/consolidado_tot[consolidado_tot$YEAR == (y-1)   & consolidado_tot$MONTH == m,"TOTAL_COT"]
    consolidado_tot[consolidado_tot$YEAR == y   & consolidado_tot$MONTH == m,"var_anual_ind"]<-(consolidado_tot[consolidado_tot$YEAR == y   & consolidado_tot$MONTH == m,"Total_ind"]-consolidado_tot[consolidado_tot$YEAR == (y-1)   & consolidado_tot$MONTH == m,"Total_ind"])/consolidado_tot[consolidado_tot$YEAR == (y-1)   & consolidado_tot$MONTH == m,"Total_ind"]
    consolidado_tot[consolidado_tot$YEAR == y   & consolidado_tot$MONTH == m,"var_anual_dep"]<-(consolidado_tot[consolidado_tot$YEAR == y   & consolidado_tot$MONTH == m,"Total_dep"]-consolidado_tot[consolidado_tot$YEAR == (y-1)   & consolidado_tot$MONTH == m,"Total_dep"])/consolidado_tot[consolidado_tot$YEAR == (y-1)   & consolidado_tot$MONTH == m,"Total_dep"]
    consolidado_tot[consolidado_tot$YEAR == y   & consolidado_tot$MONTH == m,"var_anual_dep_sec_priv"]<-(consolidado_tot[consolidado_tot$YEAR == y   & consolidado_tot$MONTH == m,"Total_sec_priv"]-consolidado_tot[consolidado_tot$YEAR == (y-1)   & consolidado_tot$MONTH == m,"Total_sec_priv"])/consolidado_tot[consolidado_tot$YEAR == (y-1)   & consolidado_tot$MONTH == m,"Total_sec_priv"]
  }
}

consolidado_tot$Total_indp<-formatC(consolidado_tot$Total_ind/1000,big.mark = ".",decimal.mark = ",",digits = 1,format = "f")
consolidado_tot$Total_depp<-formatC(consolidado_tot$Total_dep/1000,big.mark = ".",decimal.mark = ",",digits = 1,format = "f")
consolidado_tot$Total_sec_privp<-formatC(consolidado_tot$Total_sec_priv/1000,big.mark = ".",decimal.mark = ",",digits = 1,format = "f")
consolidado_tot$TOTAL_COTp<-formatC(consolidado_tot$TOTAL_COT/1000,big.mark = ".",decimal.mark = ",",digits = 1,format = "f")
consolidado_tot$var_anual_totp<-paste0(formatC(consolidado_tot$var_anual_tot*100,big.mark = ".",decimal.mark = ",",digits = 2,format = "f"),"%")
consolidado_tot$var_mensual_totp<-paste0(formatC(consolidado_tot$var_mensual_tot*100,big.mark = ".",decimal.mark = ",",digits = 2,format = "f"),"%")
consolidado_tot$var_anual_indp<-paste0(formatC(consolidado_tot$var_anual_ind*100,big.mark = ".",decimal.mark = ",",digits = 2,format = "f"),"%")
consolidado_tot$var_mensual_indp<-paste0(formatC(consolidado_tot$var_mensual_ind*100,big.mark = ".",decimal.mark = ",",digits = 2,format = "f"),"%")
consolidado_tot$var_anual_depp<-paste0(formatC(consolidado_tot$var_anual_dep*100,big.mark = ".",decimal.mark = ",",digits = 2,format = "f"),"%")
consolidado_tot$var_mensual_depp<-paste0(formatC(consolidado_tot$var_mensual_dep*100,big.mark = ".",decimal.mark = ",",digits = 2,format = "f"),"%")
consolidado_tot$var_anual_dep_sec_privp<-paste0(formatC(consolidado_tot$var_anual_dep_sec_priv*100,big.mark = ".",decimal.mark = ",",digits = 2,format = "f"),"%")
consolidado_tot$var_mensual_dep_sec_privp<-paste0(formatC(consolidado_tot$var_mensual_dep_sec_priv*100,big.mark = ".",decimal.mark = ",",digits = 2,format = "f"),"%")
mes2<-c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic")
mes_rep<-data.frame(c(1:12),mes2);colnames(mes_rep)<-c("month","mes2")
consolidado_tot<-merge(consolidado_tot,mes_rep, by.x = "MONTH", by.y = "month", all.x = TRUE)

##########cambiar
mes_ref = 12
year_ref = 2021

#tabla1_1
consolidado_tot%>%filter(MONTH == mes_ref)%>%
  select(YEAR,TOTAL_COTp,var_anual_totp,var_mensual_totp,Total_depp,var_anual_depp,var_mensual_depp,Total_indp,var_anual_indp,var_mensual_indp)%>%
  arrange(desc(YEAR))%>%
  kbl(caption = "Comportamiento del periodo de análisis", align = "lccccccccc", 
      col.names = c("Año","Total cotizantes","Var anual","Var mensual","Total cotizantes","Var anual","Var mensual","Total cotizantes","Var anual","Var mensual"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
 #row_spec(row = 1,bold = TRUE)%>%
  row_spec(row = 0, bold = TRUE,# color = "white", background = "#00BFFF",
           font_size = "large")%>%
  add_header_above(c(" ","Total cotizantes" = 3,"Dependientes" = 3,"Independientes" = 3))

tipo_general<-c(1,1.040,1.040,1.059,1.071,1.071,1.056,1.071,1.096,1.087,1.079,1.057)
tipo_dependientes<-c(1,1.042,1.039,1.061,1.073,1.069,1.05,1.068,1.095,1.082,1.077,1.053)
tipo_independientes<-c(1,1.028,1.045,1.048,1.062,1.078,1.085,1.085,1.097,1.113,1.088,1.081)
consolidado_tipo_19<-consolidado_tot[consolidado_tot$YEAR == 2019,c("MONTH","TOTAL_COT")]
consolidado_tipo_20<-consolidado_tot[consolidado_tot$YEAR == 2020,c("MONTH","TOTAL_COT")]
consolidado_tipo_19d<-consolidado_tot[consolidado_tot$YEAR == 2019,c("MONTH","Total_dep")]
consolidado_tipo_20d<-consolidado_tot[consolidado_tot$YEAR == 2020,c("MONTH","Total_dep")]
consolidado_tipo_19i<-consolidado_tot[consolidado_tot$YEAR == 2019,c("MONTH","Total_ind")]
consolidado_tipo_20i<-consolidado_tot[consolidado_tot$YEAR == 2020,c("MONTH","Total_ind")]

consolidado_tipo<-consolidado_tot[consolidado_tot$YEAR == year_ref,c("MONTH","TOTAL_COT")]
consolidado_tipo$Esperado_tradicional<-consolidado_tipo[consolidado_tipo$MONTH == 1,"TOTAL_COT"]*tipo_general
#CAMBIAR EL VALOR ESTIMADO DE ENERO 
consolidado_tipo$Esperado_enero<-11993732*tipo_general
consolidado_tipo$Diferencia = (consolidado_tipo$TOTAL_COT - consolidado_tipo$Esperado_enero)
consolidado_tipo$Var_por = (consolidado_tipo$TOTAL_COT - consolidado_tipo$Esperado_enero)/consolidado_tipo$Esperado_enero

consolidado_tipod<-consolidado_tot[consolidado_tot$YEAR == year_ref,c("MONTH","Total_dep")]
consolidado_tipod$Esperado_tradicional<-consolidado_tipod[consolidado_tipod$MONTH == 1,"Total_dep"]*tipo_dependientes
#CAMBIAR EL VALOR ESTIMADO DE ENERO 
consolidado_tipod$Esperado_enero<-9906736*tipo_dependientes
consolidado_tipod$Diferencia = (consolidado_tipod$Total_dep - consolidado_tipod$Esperado_enero)
consolidado_tipod$Var_por = (consolidado_tipod$Total_dep - consolidado_tipod$Esperado_enero)/consolidado_tipod$Esperado_enero

consolidado_tipoi<-consolidado_tot[consolidado_tot$YEAR == year_ref,c("MONTH","Total_ind")]
consolidado_tipoi$Esperado_tradicional<-consolidado_tipoi[consolidado_tipoi$MONTH == 1,"Total_ind"]*tipo_independientes
#CAMBIAR EL VALOR ESTIMADO DE ENERO 
consolidado_tipoi$Esperado_enero<-2129681 *tipo_independientes
consolidado_tipoi$Diferencia = (consolidado_tipoi$Total_ind- consolidado_tipoi$Esperado_enero)
consolidado_tipoi$Var_por = (consolidado_tipoi$Total_ind - consolidado_tipoi$Esperado_enero)/consolidado_tipoi$Esperado_enero

consolidado_tipo_tab<-data.frame(
  Mes = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"),
  Cotizantes = formatC(consolidado_tipo$TOTAL_COT/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Cotizantes_esperado_tradicional = formatC(consolidado_tipo$Esperado_tradicional/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Cotizantes_esperado = formatC(consolidado_tipo$Esperado_enero/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Diferencia = formatC(consolidado_tipo$Diferencia/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Var_por = paste0(round(consolidado_tipo$Var_por * 100,2), "%")
)
consolidado_tipod_tabd<-data.frame(
  Mes = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"),
  Cotizantes = formatC(consolidado_tipod$Total_dep/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Cotizantes_esperado_tradicional = formatC(consolidado_tipod$Esperado_tradicional/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Cotizantes_esperado = formatC(consolidado_tipod$Esperado_enero/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Diferencia = formatC(consolidado_tipod$Diferencia/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Var_por = paste0(round(consolidado_tipod$Var_por * 100,2), "%")
)
consolidado_tipoi_tabd<-data.frame(
  Mes = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"),
  Cotizantes = formatC(consolidado_tipoi$Total_ind/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Cotizantes_esperado_tradicional = formatC(consolidado_tipoi$Esperado_tradicional/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Cotizantes_esperado = formatC(consolidado_tipoi$Esperado_enero/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Diferencia = formatC(consolidado_tipoi$Diferencia/1000,format = "f", big.mark = ".",decimal.mark = ",",digits = 1),
  Var_por = paste0(round(consolidado_tipoi$Var_por * 100,2), "%")
)

#tabla1_1_1
#tabla_tot_1_1<-consolidado_tipo_tab%>%
#  select(Mes,Cotizantes,Cotizantes_esperado_tradicional ,Cotizantes_esperado ,Diferencia ,Var_por)%>%
#  kbl(caption = "Total cotizantes frente a año tipo", align = "lccccc", 
#      col.names = c("Año","Total cotizantes (A)","Esperado Enero (B)","Esperado Enero Est (C)","Diferencia (C-A)","Var (C A)"))%>%
#  kable_classic(full_width = F, html_font = "Calibri")%>%
#  #row_spec(row = 1,bold = TRUE)%>%
#  row_spec(row = 0, bold = TRUE,# color = "white", background = "#00BFFF",
#           font_size = "large")
tabla_tot_1_1<-ggtexttable(consolidado_tipo_tab,rows = NULL,
                           cols = c("Año","Total cotizantes (A)","Esperado Enero (B)","Esperado Enero Est (C)","Diferencia (C-A)","Var (C A)"),
                           theme = ttheme("light", base_size = 10))
tabla_tot_1_1d<-ggtexttable(consolidado_tipod_tabd,rows = NULL,
                           cols = c("Año","Total cotizantes (A)","Esperado Enero (B)","Esperado Enero Est (C)","Diferencia (C-A)","Var (C A)"),
                           theme = ttheme("light", base_size = 10))
tabla_tot_1_1i<-ggtexttable(consolidado_tipoi_tabd,rows = NULL,
                           cols = c("Año","Total cotizantes (A)","Esperado Enero (B)","Esperado Enero Est (C)","Diferencia (C-A)","Var (C A)"),
                           theme = ttheme("light", base_size = 10))

Mes = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic")
grafico_tot_1_1<-rbind(
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = consolidado_tipo$TOTAL_COT, Categoria = rep("Observado_2021",nrow(consolidado_tipo))),
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = tipo_general*consolidado_tipo$Esperado_enero[1], Categoria = rep("Esperado_ajustado",nrow(consolidado_tipo))),
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = consolidado_tipo_19$TOTAL_COT, Categoria = rep("Observado_2019",nrow(consolidado_tipo_19))),
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = consolidado_tipo_20$TOTAL_COT, Categoria = rep("Observado_2020",nrow(consolidado_tipo_20))))

grafico_tot_1_1d<-rbind(
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = consolidado_tipod$Total_dep, Categoria = rep("Observado_2021",nrow(consolidado_tipod))),
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = tipo_dependientes*consolidado_tipod$Esperado_enero[1], Categoria = rep("Esperado_ajustado",nrow(consolidado_tipod))),
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = consolidado_tipo_19d$Total_dep, Categoria = rep("Observado_2019",nrow(consolidado_tipo_19d))),
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = consolidado_tipo_20d$Total_dep, Categoria = rep("Observado_2020",nrow(consolidado_tipo_20d))))

grafico_tot_1_1i<-rbind(
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = consolidado_tipoi$Total_ind, Categoria = rep("Observado_2021",nrow(consolidado_tipoi))),
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = tipo_independientes*consolidado_tipoi$Esperado_enero[1], Categoria = rep("Esperado_ajustado",nrow(consolidado_tipoi))),
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = consolidado_tipo_19i$Total_ind, Categoria = rep("Observado_2019",nrow(consolidado_tipo_19i))),
  data.frame(Mes_num = 1:12,Mes = Mes,Tipo_tot = consolidado_tipo_20i$Total_ind, Categoria = rep("Observado_2020",nrow(consolidado_tipo_20i))))

grafico_tot_1_1$Categoria <- as.factor(grafico_tot_1_1$Categoria)
levels(grafico_tot_1_1$Categoria) <- c('Esperado (A)', '2019(O)', '2020(O)', '2021(O)')

grafico_tot_1_1d$Categoria <- as.factor(grafico_tot_1_1d$Categoria)
levels(grafico_tot_1_1d$Categoria) <- c('Esperado (A)', '2019(O)', '2020(O)', '2021(O)')

grafico_tot_1_1i$Categoria <- as.factor(grafico_tot_1_1i$Categoria)
levels(grafico_tot_1_1i$Categoria) <- c('Esperado (A)', '2019(O)', '2020(O)', '2021(O)')


grafico_tot_1_1_1<-ggplot(data = grafico_tot_1_1, aes(x = fct_relevel(Mes, "Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"),
  y = Tipo_tot/1e6, group = Categoria, color = Categoria))+
  geom_line(aes(linetype = Categoria, color = Categoria))+
  ggtitle("Total cotizantes observados y esperados en 2021 (Millones)",subtitle = "Todos los cotizantes")+
  xlab("Mes")+ylab("Total")+ theme_calc()+ scale_colour_calc() + 
  scale_color_manual(values = c("darkorange","grey50","grey50","black"))+
  scale_size_manual(values = c(20,1,1,20))+
  scale_linetype_manual(values = c("solid","dotted","dashed","solid")) +
  scale_y_continuous(breaks = breaks_pretty(n = 20))#+
  #theme(legend.position = "top")

grafico_tot_1_1_1d<-ggplot(data = grafico_tot_1_1d, aes(x = fct_relevel(Mes, "Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"),y = Tipo_tot/1e6, group = Categoria, color = Categoria))+geom_line(aes(linetype = Categoria, color = Categoria))+
  ggtitle("Total cotizantes observados y esperados en 2021 (Millones)",subtitle = "Cotizantes dependientes")+
  xlab("Mes")+ylab("Total")+ theme_calc()+ scale_colour_calc() + 
  scale_color_manual(values = c("darkorange","grey50","grey50","blue"))+
  scale_size_manual(values = c(20,1,1,20))+
  scale_linetype_manual(values = c("solid","dotted","dashed","solid"))+
  scale_y_continuous(breaks = breaks_pretty(n = 20))#+#+
  #theme(legend.position = "top")

grafico_tot_1_1_1i<-ggplot(data = grafico_tot_1_1i, aes(x = fct_relevel(Mes, "Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"),y = Tipo_tot/1e6, group = Categoria, color = Categoria))+
  geom_line(aes(linetype = Categoria, color = Categoria))+
  ggtitle("Comportamiento tipo inter-anual",subtitle = "Cotizantes independientes")+
  xlab("Mes")+ylab("Total")+ theme_calc()+ scale_colour_calc() + 
  scale_color_manual(values = c("darkorange","grey50","grey50","red"))+
  scale_size_manual(values = c(20,1,1,20))+
  scale_linetype_manual(values = c("solid","dotted","dashed","solid"))+
  scale_y_continuous(breaks = breaks_pretty(n = 20))#+#+
  #theme(legend.position = "top")
setwd('D:/CONSULTORIAS/UGPP/2022/Proyectos/Boletin_UGPP/report/')
ggsave(filename = '../figures/Capitulo_2_1/grafico_tot_1_1_1.png', width = 8, height = 6, plot = grafico_tot_1_1_1)
ggsave(filename = '../figures/Capitulo_2_1/grafico_tot_1_1_1d.png', width = 8, height = 6, plot = grafico_tot_1_1_1d)
ggsave(filename = '../figures/Capitulo_2_1/grafico_tot_1_1_1i.png', width = 8, height = 6, plot = grafico_tot_1_1_1i)

ggarrange(grafico_tot_1_1_1d,tabla_tot_1_1d,nrow = 1, ncol = 2)
ggarrange(grafico_tot_1_1_1i,tabla_tot_1_1i,nrow = 1, ncol = 2)
ggarrange(grafico_tot_1_1_1,tabla_tot_1_1,nrow = 1, ncol = 2)

```

## Distribución por Rango Salarial

En diciembre 2021 se encontro un decrecimiento mensual de `r round((grafico_tot_1_1[grafico_tot_1_1$Mes_num == 12  & grafico_tot_1_1$Categoria == "Observado_2021", "Tipo_tot"]-grafico_tot_1_1[grafico_tot_1_1$Mes_num == 11  & grafico_tot_1_1$Categoria == "Observado_2021", "Tipo_tot"])/grafico_tot_1_1[grafico_tot_1_1$Mes_num == 11  & grafico_tot_1_1$Categoria == "Observado_2021", "Tipo_tot"]*100,2)` % que es superior al, `r round((grafico_tot_1_1d[grafico_tot_1_1d$Mes_num == 12  & grafico_tot_1_1d$Categoria == "Observado_2020", "Tipo_tot"]-grafico_tot_1_1d[grafico_tot_1_1d$Mes_num == 11  & grafico_tot_1_1d$Categoria == "Observado_2020", "Tipo_tot"])/grafico_tot_1_1d[grafico_tot_1_1d$Mes_num == 11  & grafico_tot_1_1d$Categoria == "Observado_2020", "Tipo_tot"]*100,2)` % del 2020 y mas cercano al `r round((grafico_tot_1_1i[grafico_tot_1_1i$Mes_num == 12  & grafico_tot_1_1i$Categoria == "Observado_2019", "Tipo_tot"]-grafico_tot_1_1i[grafico_tot_1_1i$Mes_num == 11  & grafico_tot_1_1i$Categoria == "Observado_2019", "Tipo_tot"])/grafico_tot_1_1i[grafico_tot_1_1i$Mes_num == 11  & grafico_tot_1_1i$Categoria == "Observado_2019", "Tipo_tot"]*100,2)`% del 2019. Para los dependientes e independientes el decrecimiento fue de `r round((grafico_tot_1_1d[grafico_tot_1_1d$Mes_num == 12  & grafico_tot_1_1d$Categoria == "Observado_2021", "Tipo_tot"]-grafico_tot_1_1d[grafico_tot_1_1d$Mes_num == 11  & grafico_tot_1_1d$Categoria == "Observado_2021", "Tipo_tot"])/grafico_tot_1_1d[grafico_tot_1_1d$Mes_num == 11  & grafico_tot_1_1d$Categoria == "Observado_2021", "Tipo_tot"]*100,2)` % y `r round((grafico_tot_1_1i[grafico_tot_1_1i$Mes_num == 12  & grafico_tot_1_1i$Categoria == "Observado_2021", "Tipo_tot"]-grafico_tot_1_1i[grafico_tot_1_1i$Mes_num == 11  & grafico_tot_1_1i$Categoria == "Observado_2021", "Tipo_tot"])/grafico_tot_1_1i[grafico_tot_1_1i$Mes_num == 11  & grafico_tot_1_1i$Categoria == "Observado_2021", "Tipo_tot"]*100,2)` que son superiores a los tipo que estan por los  `r round((grafico_tot_1_1d[grafico_tot_1_1d$Mes_num == 12  & grafico_tot_1_1d$Categoria == "Esperado_ajustado", "Tipo_tot"]-grafico_tot_1_1d[grafico_tot_1_1d$Mes_num == 11  & grafico_tot_1_1d$Categoria == "Esperado_ajustado", "Tipo_tot"])/grafico_tot_1_1d[grafico_tot_1_1d$Mes_num == 11  & grafico_tot_1_1d$Categoria == "Esperado_ajustado", "Tipo_tot"]*100,2)`% y `r round((grafico_tot_1_1i[grafico_tot_1_1i$Mes_num == 12  & grafico_tot_1_1i$Categoria == "Esperado_ajustado", "Tipo_tot"]-grafico_tot_1_1i[grafico_tot_1_1i$Mes_num == 11  & grafico_tot_1_1i$Categoria == "Esperado_ajustado", "Tipo_tot"])/grafico_tot_1_1i[grafico_tot_1_1i$Mes_num == 11  & grafico_tot_1_1i$Categoria == "Esperado_ajustado", "Tipo_tot"]*100,2)`% y el general de `r round((grafico_tot_1_1[grafico_tot_1_1$Mes_num == 12  & grafico_tot_1_1$Categoria == "Esperado_ajustado", "Tipo_tot"]-grafico_tot_1_1[grafico_tot_1_1$Mes_num == 11  & grafico_tot_1_1$Categoria == "Esperado_ajustado", "Tipo_tot"])/grafico_tot_1_1[grafico_tot_1_1$Mes_num == 11  & grafico_tot_1_1$Categoria == "Esperado_ajustado", "Tipo_tot"]*100,2)`%.


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 4.5, fig.width = 12}
library(matrixcalc)
library(dplyr)

setwd("../../../data/raw/")

#tabla<-"Salidas_generales_rangoIBC9_12_2021.csv"

salida_IBC<-function(tabla){
  base<-read.csv2(tabla,dec = ".")
  base<-base[,c("YEAR","MONTH","Tipologia","Rango_IBC","Total_relaciones_laborales")]
  base$Rango_IBC_salida<-NULL
  base[base$Rango_IBC == 0.5, "Rango_IBC_salida"]<-rep("<1_SMMLV",nrow(base[base$Rango_IBC == 0.5,]))
  base[base$Rango_IBC == 1, "Rango_IBC_salida"]<-rep("1_SMMLV",nrow(base[base$Rango_IBC == 1,]))
  base[base$Rango_IBC > 1 & base$Rango_IBC <= 2, "Rango_IBC_salida"]<-rep("1-2_SMMLV",nrow(base[base$Rango_IBC > 1 & base$Rango_IBC <= 2,]))
  base[base$Rango_IBC > 2 & base$Rango_IBC <= 5, "Rango_IBC_salida"]<-rep("2-5_SMMLV",nrow(base[base$Rango_IBC > 2 & base$Rango_IBC <= 5,]))
  base[base$Rango_IBC > 5, "Rango_IBC_salida"]<-rep(">5_SMMLV",nrow(base[base$Rango_IBC > 5,]))
  base$Tipologia2<-NULL
  base[base$Tipologia %in% c("Dep_No_priv","Dep_sec_priv"),"Tipologia2"]<-rep("Dependientes", nrow(base[base$Tipologia %in% c("Dep_No_priv","Dep_sec_priv"),]))
  base[base$Tipologia =="Independiente","Tipologia2"]<-rep("Independientes", nrow(base[base$Tipologia =="Independiente",]))

  Resumen_rango<-data.frame(base%>%group_by(Tipologia2,Rango_IBC_salida)%>%summarise(Total = n()))

  for(m in unique(base$MONTH)){
  base_sub_res<-data.frame(base%>%filter(MONTH == m)%>%group_by(Tipologia2,Rango_IBC_salida)%>%summarise(Total_cot = sum(Total_relaciones_laborales, na.rm = TRUE)))
  base_sub_res_tot<-data.frame(base%>%filter(MONTH == m)%>%group_by(Rango_IBC_salida)%>%summarise(Total_cot = sum(Total_relaciones_laborales, na.rm = TRUE)))
  base_sub_res_tot$Tipologia2<-rep("Total",nrow(base_sub_res_tot))
  base_sub_res<-rbind(base_sub_res,base_sub_res_tot)
  colnames(base_sub_res)<-c("Tipologia2","Rango_IBC_salida",paste0("Total_cot_",base$YEAR[1],"_",m))
  Resumen_rango<-merge(Resumen_rango,base_sub_res, by = c("Tipologia2","Rango_IBC_salida"), all = TRUE)
  }
  Resumen_rango<-Resumen_rango[,-3]
  Resumen_rango
}  

salida_IBC_9_12_21<-salida_IBC("Salidas_generales_rangoIBC9_12_2021.csv")
salida_IBC_9_12_20<-salida_IBC("Salidas_generales_rangoIBC9_12_2020.csv")
salida_IBC_9_12_19<-salida_IBC("Salidas_generales_rangoIBC9_12_2019.csv")
salida_IBC_9_12_18<-salida_IBC("Salidas_generales_rangoIBC9_12_2018.csv")
salida_IBC_9_12_17<-salida_IBC("Salidas_generales_rangoIBC9_12_2017.csv")

salida_IBC_res<-merge(salida_IBC_9_12_17,salida_IBC_9_12_18, by = c("Tipologia2","Rango_IBC_salida"), all = TRUE)
salida_IBC_res<-merge(salida_IBC_res,salida_IBC_9_12_19, by = c("Tipologia2","Rango_IBC_salida"), all = TRUE)
salida_IBC_res<-merge(salida_IBC_res,salida_IBC_9_12_20, by = c("Tipologia2","Rango_IBC_salida"), all = TRUE)
salida_IBC_res<-merge(salida_IBC_res,salida_IBC_9_12_21, by = c("Tipologia2","Rango_IBC_salida"), all = TRUE)

salida_IBC_res$var_anual_21<-(salida_IBC_res$Total_cot_2021_12-salida_IBC_res$Total_cot_2020_12)/salida_IBC_res$Total_cot_2020_12
salida_IBC_res$var_anual_20<-(salida_IBC_res$Total_cot_2020_12-salida_IBC_res$Total_cot_2019_12)/salida_IBC_res$Total_cot_2019_12
salida_IBC_res$var_anual_19<-(salida_IBC_res$Total_cot_2019_12-salida_IBC_res$Total_cot_2018_12)/salida_IBC_res$Total_cot_2018_12
salida_IBC_res$var_anual_18<-(salida_IBC_res$Total_cot_2018_12-salida_IBC_res$Total_cot_2017_12)/salida_IBC_res$Total_cot_2017_12

salida_IBC_res$var_mes_21<-(salida_IBC_res$Total_cot_2021_12-salida_IBC_res$Total_cot_2021_11)/salida_IBC_res$Total_cot_2021_11
salida_IBC_res$var_mes_20<-(salida_IBC_res$Total_cot_2020_12-salida_IBC_res$Total_cot_2020_11)/salida_IBC_res$Total_cot_2020_11
salida_IBC_res$var_mes_19<-(salida_IBC_res$Total_cot_2019_12-salida_IBC_res$Total_cot_2019_11)/salida_IBC_res$Total_cot_2019_11
salida_IBC_res$var_mes_18<-(salida_IBC_res$Total_cot_2018_12-salida_IBC_res$Total_cot_2018_11)/salida_IBC_res$Total_cot_2018_11

#variacion mensual 
IBc_dep<-salida_IBC_res[salida_IBC_res$Tipologia2 == "Dependientes",]
IBc_ind<-salida_IBC_res[salida_IBC_res$Tipologia2 == "Independientes",]
grafico_2_1d<-data.frame(Rango = rep(IBc_dep$Rango_IBC_salida,4), Variacion_mensual = vec(as.matrix(IBc_dep[,c("var_mes_21","var_mes_20","var_mes_19","var_mes_18")])),Año = rep(c("2021","2020","2019","2018"),c(5,5,5,5)))
grafico_2_1d[grafico_2_1d$Rango == "<1_SMMLV", "rangonum"]<-rep(1,nrow(grafico_2_1d[grafico_2_1d$Rango == "<1_SMMLV",]));grafico_2_1d[grafico_2_1d$Rango == "1_SMMLV", "rangonum"]<-rep(2,nrow(grafico_2_1d[grafico_2_1d$Rango == "1_SMMLV",]));
grafico_2_1d[grafico_2_1d$Rango == "1-2_SMMLV", "rangonum"]<-rep(3,nrow(grafico_2_1d[grafico_2_1d$Rango == "1-2_SMMLV",]));grafico_2_1d[grafico_2_1d$Rango == "2-5_SMMLV", "rangonum"]<-rep(4,nrow(grafico_2_1d[grafico_2_1d$Rango == "2-5_SMMLV",]));
grafico_2_1d[grafico_2_1d$Rango == ">5_SMMLV", "rangonum"]<-rep(5,nrow(grafico_2_1d[grafico_2_1d$Rango == ">5_SMMLV",]));
IBC_mes_dep_gra<-ggplot(data = grafico_2_1d,
  aes(x = reorder(Rango,rangonum), y = Variacion_mensual*100, fill = Año ))+
  geom_bar(stat = "identity", position = position_dodge(width = 0.9))+
  theme_minimal()+scale_fill_brewer(palette = "YlOrBr")+
  geom_text(aes(label = round(Variacion_mensual*100,1)),vjust = 1.5, position = position_dodge(0.9),size = 2)+
  ggtitle("Variaciòn mensual en Diciembre de cada año", subtitle = "Cotizantes Dependientes")+xlab("Rango IBC")+ylab("%")

grafico_2_1i<-data.frame(Rango = rep(IBc_ind$Rango_IBC_salida,4), Variacion_mensual = vec(as.matrix(IBc_ind[,c("var_mes_21","var_mes_20","var_mes_19","var_mes_18")])),Año = rep(c("2021","2020","2019","2018"),c(5,5,5,5)))
grafico_2_1i[grafico_2_1i$Rango == "<1_SMMLV", "rangonum"]<-rep(1,nrow(grafico_2_1i[grafico_2_1i$Rango == "<1_SMMLV",]));grafico_2_1i[grafico_2_1i$Rango == "1_SMMLV", "rangonum"]<-rep(2,nrow(grafico_2_1i[grafico_2_1i$Rango == "1_SMMLV",]));
grafico_2_1i[grafico_2_1i$Rango == "1-2_SMMLV", "rangonum"]<-rep(3,nrow(grafico_2_1i[grafico_2_1i$Rango == "1-2_SMMLV",]));grafico_2_1i[grafico_2_1i$Rango == "2-5_SMMLV", "rangonum"]<-rep(4,nrow(grafico_2_1i[grafico_2_1i$Rango == "2-5_SMMLV",]));
grafico_2_1i[grafico_2_1i$Rango == ">5_SMMLV", "rangonum"]<-rep(5,nrow(grafico_2_1i[grafico_2_1i$Rango == ">5_SMMLV",]));
IBC_mes_ind_gra<-ggplot(data = grafico_2_1i,
                         aes(x = reorder(Rango,rangonum), y = Variacion_mensual*100, fill = Año ))+
  geom_bar(stat = "identity", position = position_dodge(width = 0.9))+
  theme_minimal()+scale_fill_brewer(palette = "YlOrBr")+
  geom_text(aes(label = round(Variacion_mensual*100,1)),vjust = 1.5, position = position_dodge(0.9),size = 2)+
  ggtitle("Variaciòn mensual en Diciembre de cada año.", subtitle = "Cotizantes Independientes")+xlab("Rango IBC")+ylab("%")

ggarrange(IBC_mes_dep_gra,IBC_mes_ind_gra,nrow = 1, ncol =2)


salida_IBC_res$diferencia2021<-salida_IBC_res$Total_cot_2021_12-salida_IBC_res$Total_cot_2021_11
salida_IBC_res$diferencia2020<-salida_IBC_res$Total_cot_2020_12-salida_IBC_res$Total_cot_2020_11
salida_IBC_res$diferencia2019<-salida_IBC_res$Total_cot_2019_12-salida_IBC_res$Total_cot_2019_11
salida_IBC_res$diferencia2018<-salida_IBC_res$Total_cot_2018_12-salida_IBC_res$Total_cot_2018_11

salida_IBC_res$diferencia2021a<-salida_IBC_res$Total_cot_2021_12-salida_IBC_res$Total_cot_2020_12
salida_IBC_res$diferencia2020a<-salida_IBC_res$Total_cot_2020_12-salida_IBC_res$Total_cot_2019_12
salida_IBC_res$diferencia2019a<-salida_IBC_res$Total_cot_2019_12-salida_IBC_res$Total_cot_2018_12

tabla2_1_1<-salida_IBC_res[,c("Tipologia2","Rango_IBC_salida","Total_cot_2018_12","Total_cot_2019_12","Total_cot_2020_12","Total_cot_2021_12","diferencia2021","diferencia2020","diferencia2019","diferencia2018","diferencia2021a","diferencia2020a","diferencia2019a")]
tabla2_1_1_subtotales<-data.frame(tabla2_1_1%>%group_by(Tipologia2)%>%
    summarise(Total_cot_2018_12 = sum(Total_cot_2018_12,na.rm = TRUE),Total_cot_2019_12 = sum(Total_cot_2021_12,na.rm = TRUE), Total_cot_2020_12 = sum(Total_cot_2020_12,na.rm = TRUE), Total_cot_2021_12 = sum(Total_cot_2021_12,na.rm = TRUE),
      diferencia2021 = sum(diferencia2021,na.rm = TRUE),    diferencia2020  = sum(diferencia2020,na.rm = TRUE),   diferencia2019 = sum(diferencia2019,na.rm = TRUE),    diferencia2018 = sum(diferencia2018,na.rm = TRUE),    diferencia2021a = sum(diferencia2021a,na.rm = TRUE),  
     diferencia2020a = sum(diferencia2020a,na.rm = TRUE),   diferencia2019a = sum(diferencia2019a,na.rm = TRUE),))
tabla2_1_1_subtotales$Rango_IBC_salida<-rep("Total", nrow(tabla2_1_1_subtotales))
tabla2_1_2<-rbind(tabla2_1_1,tabla2_1_1_subtotales)
tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "<1_SMMLV", "Rango_IBC_salidanum"]<-rep(1,nrow(tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "<1_SMMLV",]));tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "1_SMMLV", "Rango_IBC_salidanum"]<-rep(2,nrow(tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "1_SMMLV",]));
tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "1-2_SMMLV", "Rango_IBC_salidanum"]<-rep(3,nrow(tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "1-2_SMMLV",]));tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "2-5_SMMLV", "Rango_IBC_salidanum"]<-rep(4,nrow(tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "2-5_SMMLV",]));
tabla2_1_2[tabla2_1_2$Rango_IBC_salida == ">5_SMMLV", "Rango_IBC_salidanum"]<-rep(5,nrow(tabla2_1_2[tabla2_1_2$Rango_IBC_salida == ">5_SMMLV",]));tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "Total", "Rango_IBC_salidanum"]<-rep(6,nrow(tabla2_1_2[tabla2_1_2$Rango_IBC_salida == "Total",]));
tabla2_1_2<-data.frame(tabla2_1_2%>%arrange(Tipologia2,Rango_IBC_salidanum))
for(i in 3:ncol(tabla2_1_2)){
  tabla2_1_2[,i]<-formatC(tabla2_1_2[,i]/1000,big.mark = ".",digits = 1,decimal.mark = ",",format = "f")
}

tabla2_1_2%>%
  select(Tipologia2,Rango_IBC_salida,Total_cot_2019_12,Total_cot_2020_12,Total_cot_2021_12,
         diferencia2018,diferencia2019, diferencia2020, diferencia2021,diferencia2019a,diferencia2020a,diferencia2021a)%>%
  kbl(caption = "Total, diferencia mensuales y anuales de los cotizantes en diciembre 2021", align = "llcccccccccc", 
      col.names = c("Tipo cot.","Rango IBC","Cot. 2019","Cot. 2020","Cot. 2021","2018","2019","2020","2021","2019","2020","2021"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 6,bold = TRUE)%>%
  row_spec(row = 12,bold = TRUE)%>%
  row_spec(row = 18,bold = TRUE)%>%
  row_spec(row = 0, bold = TRUE)%>%#, color = "white", background = "#00BFFF",font_size = "large")
  add_header_above(c(" " = 2,"Total cot. Diciembre" = 3,"Diferencia mes" = 4,"Diferencia anual" = 3))

IBc_dep<-salida_IBC_res[salida_IBC_res$Tipologia2 == "Dependientes",]
grafico_2_1d<-data.frame(Rango = rep(IBc_dep$Rango_IBC_salida,3), Variacion_anual = vec(as.matrix(IBc_dep[,c("var_anual_21","var_anual_20","var_anual_19")])),Año = rep(c("2021","2020","2019"),c(5,5,5)))
grafico_2_1d[grafico_2_1d$Rango == "<1_SMMLV", "rangonum"]<-rep(1,nrow(grafico_2_1d[grafico_2_1d$Rango == "<1_SMMLV",]));grafico_2_1d[grafico_2_1d$Rango == "1_SMMLV", "rangonum"]<-rep(2,nrow(grafico_2_1d[grafico_2_1d$Rango == "1_SMMLV",]));
grafico_2_1d[grafico_2_1d$Rango == "1-2_SMMLV", "rangonum"]<-rep(3,nrow(grafico_2_1d[grafico_2_1d$Rango == "1-2_SMMLV",]));grafico_2_1d[grafico_2_1d$Rango == "2-5_SMMLV", "rangonum"]<-rep(4,nrow(grafico_2_1d[grafico_2_1d$Rango == "2-5_SMMLV",]));
grafico_2_1d[grafico_2_1d$Rango == ">5_SMMLV", "rangonum"]<-rep(5,nrow(grafico_2_1d[grafico_2_1d$Rango == ">5_SMMLV",]));
IBC_mes_dep_gra<-ggplot(data = grafico_2_1d,
                        aes(x = reorder(Rango,rangonum), y = Variacion_anual*100, fill = Año ))+
  geom_bar(stat = "identity", position = position_dodge(width = 0.9))+
  theme_minimal()+scale_fill_brewer(palette = "YlGnBu")+
  geom_text(aes(label = round(Variacion_anual*100,1)),vjust = 1.5, position = position_dodge(0.9),size = 2)+
  ggtitle("Variación anual en Diciembre", subtitle = "Cotizantes Dependientes")+xlab("Rango IBC")+ylab("%")

IBc_ind<-salida_IBC_res[salida_IBC_res$Tipologia2 == "Independientes",]
grafico_2_1i<-data.frame(Rango = rep(IBc_ind$Rango_IBC_salida,3), Variacion_anual = vec(as.matrix(IBc_ind[,c("var_anual_21","var_anual_20","var_anual_19")])),Año = rep(c("2021","2020","2019"),c(5,5,5)))
grafico_2_1i[grafico_2_1i$Rango == "<1_SMMLV", "rangonum"]<-rep(1,nrow(grafico_2_1i[grafico_2_1i$Rango == "<1_SMMLV",]));grafico_2_1i[grafico_2_1i$Rango == "1_SMMLV", "rangonum"]<-rep(2,nrow(grafico_2_1i[grafico_2_1i$Rango == "1_SMMLV",]));
grafico_2_1i[grafico_2_1i$Rango == "1-2_SMMLV", "rangonum"]<-rep(3,nrow(grafico_2_1i[grafico_2_1i$Rango == "1-2_SMMLV",]));grafico_2_1i[grafico_2_1i$Rango == "2-5_SMMLV", "rangonum"]<-rep(4,nrow(grafico_2_1i[grafico_2_1i$Rango == "2-5_SMMLV",]));
grafico_2_1i[grafico_2_1i$Rango == ">5_SMMLV", "rangonum"]<-rep(5,nrow(grafico_2_1i[grafico_2_1i$Rango == ">5_SMMLV",]));
IBC_mes_ind_gra<-ggplot(data = grafico_2_1i,
                        aes(x = reorder(Rango,rangonum), y = Variacion_anual*100, fill = Año ))+
  geom_bar(stat = "identity", position = position_dodge(width = 0.9))+
  theme_minimal()+scale_fill_brewer(palette = "YlGnBu")+
  geom_text(aes(label = round(Variacion_anual*100,1)),vjust = 1.5, position = position_dodge(0.9),size = 2)+
  ggtitle("Variación anual en Diciembre", subtitle = "Cotizantes Independientes")+xlab("Rango IBC")+ylab("%")

ggarrange(IBC_mes_dep_gra,IBC_mes_ind_gra,nrow = 1, ncol =2)

```

## Comportamiento de las novedades

### Dependientes 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 4.5, fig.width = 12}
setwd("../../../data/raw/")

novedades<-function(tabla){
  base<-read.csv2(tabla,dec = ".")
  Indepedientes<-data.frame(base%>%filter(Tipologia == "Independiente")%>%group_by(YEAR,MONTH)%>%summarise(
    Ingreso = sum(ingreso_Max_Sum,na.rm = TRUE),Por_ingreso = sum(ingreso_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Retiro = sum(retiro_Max_Sum,na.rm = TRUE),Por_retiro = sum(retiro_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Suspension = sum(suspension_temporal_Max_Sum,na.rm = TRUE),Por_suspension = sum(suspension_temporal_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Var_transitoria = sum(variacion_transitoria_salario_Max_Sum, na.rm = TRUE),Por_var_transitoria = sum(variacion_transitoria_salario_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Var_permanente = sum(variacion_permanente_salario_Max_Sum,na.rm = TRUE),Por_var_permanentes = sum(variacion_permanente_salario_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Incapacidades = sum(incapacidas_por_trabajo_Max_Sum,na.rm = TRUE), Por_incapacidades = sum(incapacidas_por_trabajo_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Vacaciones = sum(vacaciones_Max_Sum, na.rm = TRUE),Por_vacaciones = sum(vacaciones_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Licencia = sum(licencia_maternidad_Max_Sum,na.rm = TRUE),Por_licencia = sum(licencia_maternidad_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Total = sum(Total_relaciones_laborales,na.rm = TRUE)))
  Dependientes<-data.frame(base%>%filter(Tipologia %in% c("Dep_sec_priv","Dep_No_priv"))%>%group_by(YEAR,MONTH)%>%summarise(
    Ingreso = sum(ingreso_Max_Sum,na.rm = TRUE),Por_ingreso = sum(ingreso_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Retiro = sum(retiro_Max_Sum,na.rm = TRUE),Por_retiro = sum(retiro_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Suspension = sum(suspension_temporal_Max_Sum,na.rm = TRUE),Por_suspension = sum(suspension_temporal_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Var_transitoria = sum(variacion_transitoria_salario_Max_Sum, na.rm = TRUE),Por_var_transitoria = sum(variacion_transitoria_salario_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Var_permanente = sum(variacion_permanente_salario_Max_Sum,na.rm = TRUE),Por_var_permanentes = sum(variacion_permanente_salario_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Incapacidades = sum(incapacidas_por_trabajo_Max_Sum,na.rm = TRUE), Por_incapacidades = sum(incapacidas_por_trabajo_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Vacaciones = sum(vacaciones_Max_Sum, na.rm = TRUE),Por_vacaciones = sum(vacaciones_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Licencia = sum(licencia_maternidad_Max_Sum,na.rm = TRUE),Por_licencia = sum(licencia_maternidad_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Total = sum(Total_relaciones_laborales,na.rm = TRUE)))
  Privados<-data.frame(base%>%filter(Tipologia == "Dep_sec_priv")%>%group_by(YEAR,MONTH)%>%summarise(
    Ingreso = sum(ingreso_Max_Sum,na.rm = TRUE),Por_ingreso = sum(ingreso_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Retiro = sum(retiro_Max_Sum,na.rm = TRUE),Por_retiro = sum(retiro_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Suspension = sum(suspension_temporal_Max_Sum,na.rm = TRUE),Por_suspension = sum(suspension_temporal_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Var_transitoria = sum(variacion_transitoria_salario_Max_Sum, na.rm = TRUE),Por_var_transitoria = sum(variacion_transitoria_salario_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Var_permanente = sum(variacion_permanente_salario_Max_Sum,na.rm = TRUE),Por_var_permanentes = sum(variacion_permanente_salario_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Incapacidades = sum(incapacidas_por_trabajo_Max_Sum,na.rm = TRUE), Por_incapacidades = sum(incapacidas_por_trabajo_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Vacaciones = sum(vacaciones_Max_Sum, na.rm = TRUE),Por_vacaciones = sum(vacaciones_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Licencia = sum(licencia_maternidad_Max_Sum,na.rm = TRUE),Por_licencia = sum(licencia_maternidad_Max_Sum,na.rm = TRUE)/sum(Total_relaciones_laborales,na.rm = TRUE),
    Total = sum(Total_relaciones_laborales,na.rm = TRUE)))
  
  salida = list(Indepedientes = Indepedientes,Privados =Privados,Dependientes = Dependientes)
  salida
}

novedades_9_12_21<-novedades("Salidas_generales_rangoIBC9_12_2021.csv")
novedades_5_8_21<-novedades("Salidas_generales_rangoIBC5_8_2021.csv")
novedades_1_4_21<-novedades("Salidas_generales_rangoIBC1_4_2021.csv")
novedades_9_12_20<-novedades("Salidas_generales_rangoIBC9_12_2020.csv")
novedades_5_8_20<-novedades("Salidas_generales_rangoIBC5_8_2020.csv")
novedades_1_4_20<-novedades("Salidas_generales_rangoIBC1_4_2020.csv")
novedades_9_12_19<-novedades("Salidas_generales_rangoIBC9_12_2019.csv")
novedades_5_8_19<-novedades("Salidas_generales_rangoIBC5_8_2019.csv")
novedades_1_4_19<-novedades("Salidas_generales_rangoIBC1_4_2019.csv")
novedades_9_12_18<-novedades("Salidas_generales_rangoIBC9_12_2018.csv")
novedades_5_8_18<-novedades("Salidas_generales_rangoIBC5_8_2018.csv")
novedades_1_4_18<-novedades("Salidas_generales_rangoIBC1_4_2018.csv")
Independientes <- rbind(novedades_1_4_18$Indepedientes,novedades_5_8_18$Indepedientes,novedades_9_12_18$Indepedientes,
                        novedades_1_4_19$Indepedientes,novedades_5_8_19$Indepedientes,novedades_9_12_19$Indepedientes,
                        novedades_1_4_20$Indepedientes,novedades_5_8_20$Indepedientes,novedades_9_12_20$Indepedientes,
                        novedades_1_4_21$Indepedientes,novedades_5_8_21$Indepedientes,novedades_9_12_21$Indepedientes)
Dependientes <- rbind(novedades_1_4_18$Dependientes,novedades_5_8_18$Dependientes,novedades_9_12_18$Dependientes,
                        novedades_1_4_19$Dependientes,novedades_5_8_19$Dependientes,novedades_9_12_19$Dependientes,
                        novedades_1_4_20$Dependientes,novedades_5_8_20$Dependientes,novedades_9_12_20$Dependientes,
                        novedades_1_4_21$Dependientes,novedades_5_8_21$Dependientes,novedades_9_12_21$Dependientes)
Privados <- rbind(novedades_1_4_18$Privados,novedades_5_8_18$Privados,novedades_9_12_18$Privados,
                      novedades_1_4_19$Privados,novedades_5_8_19$Privados,novedades_9_12_19$Privados,
                      novedades_1_4_20$Privados,novedades_5_8_20$Privados,novedades_9_12_20$Privados,
                      novedades_1_4_21$Privados,novedades_5_8_21$Privados,novedades_9_12_21$Privados)
Independientes<-Independientes[order(Independientes$YEAR,Independientes$MONTH),];
Dependientes<-Dependientes[order(Dependientes$YEAR,Dependientes$MONTH),]
Privados<-Privados[order(Privados$YEAR,Privados$MONTH),]

#ajuste por vacaciones

Dependientes[Dependientes$YEAR<2020,"Vacaciones"]<-Dependientes[Dependientes$YEAR<2020,"Licencia"]
Dependientes[Dependientes$YEAR<2020,"Por_vacaciones"]<-Dependientes[Dependientes$YEAR<2020,"Por_licencia"]
Privados[Privados$YEAR<2020,"Vacaciones"]<-Privados[Privados$YEAR<2020,"Licencia"]
Privados[Privados$YEAR<2020,"Por_vacaciones"]<-Privados[Privados$YEAR<2020,"Por_licencia"]

Independientes<-data.frame(Independientes,
  var_anual_ingreso = rep(0,nrow(Independientes)),var_mensual_ingreso = rep(0,nrow(Independientes)),var_anual_retiro = rep(0,nrow(Independientes)),var_mensual_retiro = rep(0,nrow(Independientes)),
  var_anual_suspension = rep(0,nrow(Independientes)),var_mensual_suspension = rep(0,nrow(Independientes)),var_anual_transitoria = rep(0,nrow(Independientes)),var_mensual_transitoria = rep(0,nrow(Independientes)),
  var_anual_permanente = rep(0,nrow(Independientes)),var_mensual_permanente = rep(0,nrow(Independientes)),var_anual_incapacidades = rep(0,nrow(Independientes)),var_mensual_incapacidades = rep(0,nrow(Independientes)),
  var_anual_vacaciones = rep(0,nrow(Independientes)),var_mensual_vacaciones = rep(0,nrow(Independientes)),var_anual_licencia = rep(0,nrow(Independientes)),var_mensual_licencia = rep(0,nrow(Independientes)))
for(m in c(3,5,7,9,11,13,15,17)){
  for(i in 2:nrow(Independientes)){
    Independientes[i,(m+18)]<-(Independientes[i,m]-Independientes[(i-1),m])/Independientes[(i-1),m]}
  for(j in 13:nrow(Independientes)){
    Independientes[j,(m+17)]<-(Independientes[j,m]-Independientes[(j-12),m])/Independientes[(j-12),m]}
}

Dependientes<-data.frame(Dependientes,
                           var_anual_ingreso = rep(0,nrow(Dependientes)),var_mensual_ingreso = rep(0,nrow(Dependientes)),var_anual_retiro = rep(0,nrow(Dependientes)),var_mensual_retiro = rep(0,nrow(Dependientes)),
                           var_anual_suspension = rep(0,nrow(Dependientes)),var_mensual_suspension = rep(0,nrow(Dependientes)),var_anual_transitoria = rep(0,nrow(Dependientes)),var_mensual_transitoria = rep(0,nrow(Dependientes)),
                           var_anual_permanente = rep(0,nrow(Dependientes)),var_mensual_permanente = rep(0,nrow(Dependientes)),var_anual_incapacidades = rep(0,nrow(Dependientes)),var_mensual_incapacidades = rep(0,nrow(Dependientes)),
                           var_anual_vacaciones = rep(0,nrow(Dependientes)),var_mensual_vacaciones = rep(0,nrow(Dependientes)),var_anual_licencia = rep(0,nrow(Dependientes)),var_mensual_licencia = rep(0,nrow(Dependientes)))
for(m in c(3,5,7,9,11,13,15,17)){
  for(i in 2:nrow(Dependientes)){
    Dependientes[i,(m+18)]<-(Dependientes[i,m]-Dependientes[(i-1),m])/Dependientes[(i-1),m]}
  for(j in 13:nrow(Dependientes)){
    Dependientes[j,(m+17)]<-(Dependientes[j,m]-Dependientes[(j-12),m])/Dependientes[(j-12),m]}
}
Privados<-data.frame(Privados,
                         var_anual_ingreso = rep(0,nrow(Privados)),var_mensual_ingreso = rep(0,nrow(Privados)),var_anual_retiro = rep(0,nrow(Privados)),var_mensual_retiro = rep(0,nrow(Privados)),
                         var_anual_suspension = rep(0,nrow(Privados)),var_mensual_suspension = rep(0,nrow(Privados)),var_anual_transitoria = rep(0,nrow(Privados)),var_mensual_transitoria = rep(0,nrow(Privados)),
                         var_anual_permanente = rep(0,nrow(Privados)),var_mensual_permanente = rep(0,nrow(Privados)),var_anual_incapacidades = rep(0,nrow(Privados)),var_mensual_incapacidades = rep(0,nrow(Privados)),
                         var_anual_vacaciones = rep(0,nrow(Privados)),var_mensual_vacaciones = rep(0,nrow(Privados)),var_anual_licencia = rep(0,nrow(Privados)),var_mensual_licencia = rep(0,nrow(Privados)))
for(m in c(3,5,7,9,11,13,15,17)){
  for(i in 2:nrow(Privados)){
    Privados[i,(m+18)]<-(Privados[i,m]-Privados[(i-1),m])/Privados[(i-1),m]}
  for(j in 13:nrow(Privados)){
    Privados[j,(m+17)]<-(Privados[j,m]-Privados[(j-12),m])/Privados[(j-12),m]}
}

Dependientes_total<-data.frame(Mes = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"),
          var_anual_ingresos19 = paste0(formatC(Dependientes[Dependientes$YEAR == 2019,"var_anual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_anual_retiro19 = paste0(formatC(Dependientes[Dependientes$YEAR == 2019,"var_anual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_anual_suspencion19 = paste0(formatC(Dependientes[Dependientes$YEAR == 2019,"var_anual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_anual_vacaciones19 = paste0(formatC(Dependientes[Dependientes$YEAR == 2019,"var_anual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_ingresos19 = paste0(formatC(Dependientes[Dependientes$YEAR == 2019,"var_mensual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_retiro19 = paste0(formatC(Dependientes[Dependientes$YEAR == 2019,"var_mensual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_suspencion19 = paste0(formatC(Dependientes[Dependientes$YEAR == 2019,"var_mensual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_vacaciones19 = paste0(formatC(Dependientes[Dependientes$YEAR == 2019,"var_mensual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),
          var_anual_ingresos20 = paste0(formatC(Dependientes[Dependientes$YEAR == 2020,"var_anual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_anual_retiro20 = paste0(formatC(Dependientes[Dependientes$YEAR == 2020,"var_anual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_anual_suspencion20 = paste0(formatC(Dependientes[Dependientes$YEAR == 2020,"var_anual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_anual_vacaciones20 = paste0(formatC(Dependientes[Dependientes$YEAR == 2020,"var_anual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_ingresos20 = paste0(formatC(Dependientes[Dependientes$YEAR == 2020,"var_mensual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_retiro20 = paste0(formatC(Dependientes[Dependientes$YEAR == 2020,"var_mensual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_suspencion20 = paste0(formatC(Dependientes[Dependientes$YEAR == 2020,"var_mensual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_vacaciones20 = paste0(formatC(Dependientes[Dependientes$YEAR == 2020,"var_mensual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),
          var_anual_ingresos21 = paste0(formatC(Dependientes[Dependientes$YEAR == 2021,"var_anual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_anual_retiro21 = paste0(formatC(Dependientes[Dependientes$YEAR == 2021,"var_anual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_anual_suspencion21 = paste0(formatC(Dependientes[Dependientes$YEAR == 2021,"var_anual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_anual_vacaciones21 = paste0(formatC(Dependientes[Dependientes$YEAR == 2021,"var_anual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_ingresos21 = paste0(formatC(Dependientes[Dependientes$YEAR == 2021,"var_mensual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_retiro21 = paste0(formatC(Dependientes[Dependientes$YEAR == 2021,"var_mensual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_suspencion21 = paste0(formatC(Dependientes[Dependientes$YEAR == 2021,"var_mensual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
          var_mensual_vacaciones21 = paste0(formatC(Dependientes[Dependientes$YEAR == 2021,"var_mensual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"))
```
Para el periodo de Diciembre 2021 las novedades de ingreso, retiro, suspención temporal y vacaciones fueron de `r formatC(Dependientes[Dependientes$YEAR == 2021 & Dependientes$MONTH == 12,"Ingreso"], format = "f", big.mark = ".", decimal.mark = ",", digits = 0)`, `r formatC(Dependientes[Dependientes$YEAR == 2021 & Dependientes$MONTH == 12,"Retiro"], format = "f", big.mark = ".", decimal.mark = ",", digits = 0)`, `r formatC(Dependientes[Dependientes$YEAR == 2021 & Dependientes$MONTH == 12,"Suspension"], format = "f", big.mark = ".", decimal.mark = ",", digits = 0)` y `r formatC(Dependientes[Dependientes$YEAR == 2021 & Dependientes$MONTH == 12,"Vacaciones"], format = "f", big.mark = ".", decimal.mark = ",", digits = 0)` respectivamente con variaciones mensuales de `r formatC(Dependientes[Dependientes$YEAR == 2021 & Dependientes$MONTH == 12,"var_mensual_ingreso"] * 100, format = "f", big.mark = ".", decimal.mark = ",", digits = 1)`%, `r formatC(Dependientes[Dependientes$YEAR == 2021 & Dependientes$MONTH == 12,"var_mensual_retiro"]*100, format = "f", big.mark = ".", decimal.mark = ",", digits = 1)`%, `r formatC(Dependientes[Dependientes$YEAR == 2021 & Dependientes$MONTH == 12,"var_mensual_suspension"]*100, format = "f", big.mark = ".", decimal.mark = ",", digits = 1)`% y `r formatC(Dependientes[Dependientes$YEAR == 2021 & Dependientes$MONTH == 12,"var_mensual_vacaciones"]*100, format = "f", big.mark = ".", decimal.mark = ",", digits = 1 )`%. 
 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 4.5, fig.width = 12}


Grap_3_1<-ggplot(data = Dependientes[Dependientes$YEAR>=2019,], 
  mapping = aes(x = MONTH, y = Por_ingreso*100, fill = paste0(YEAR,".")))+coord_flip()+scale_fill_brewer()+
  geom_bar(stat = "identity" , position = "dodge")+labs(fill = "Años")+ylab("%")+theme_minimal()+theme(legend.position = "bottom")+
  scale_x_continuous("Meses",breaks = c(1:12),labels = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"))+geom_text(aes(label =  round(Por_ingreso*100,1)),position = position_dodge(width = 0.9), size = 2.5)

Grap_3_2<-ggplot(data = Dependientes[Dependientes$YEAR>=2019,], 
  mapping = aes(x = MONTH, y = Por_retiro*100, fill = paste0(YEAR,".")))+coord_flip()+scale_fill_brewer()+
  geom_bar(stat = "identity" , position = "dodge")+labs(fill = "Años")+ylab("%")+theme_minimal()+theme(legend.position = "bottom")+
  scale_x_continuous("Meses",breaks = c(1:12),labels = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"))+geom_text(aes(label =  round(Por_retiro*100,1)),position = position_dodge(width = 0.9), size = 2.5)

Grap_3_3<-ggplot(data = Dependientes[Dependientes$YEAR>=2019,], 
  mapping = aes(x = MONTH, y = Por_suspension*100, fill = paste0(YEAR,".")))+coord_flip()+scale_fill_brewer()+
  geom_bar(stat = "identity" , position = "dodge")+labs(fill = "Años")+ylab("%")+theme_minimal()+theme(legend.position = "bottom")+
  scale_x_continuous("Meses",breaks = c(1:12),labels = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"))+geom_text(aes(label =  round(Por_suspension*100,1)),position = position_dodge(width = 0.9), size = 2.5)

Grap_3_4<-ggplot(data = Dependientes[Dependientes$YEAR>=2019,], 
  mapping = aes(x = MONTH, y = Por_vacaciones*100, fill = paste0(YEAR,".")))+coord_flip()+scale_fill_brewer()+
  geom_bar(stat = "identity" , position = "dodge")+labs(fill = "Años")+ylab("%")+theme_minimal()+theme(legend.position = "bottom")+
  scale_x_continuous("Meses",breaks = c(1:12),labels = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"))+geom_text(aes(label =  round(Por_vacaciones*100,1)),position = position_dodge(width = 0.9), size = 2.5)

ggarrange(Grap_3_1,Grap_3_2,Grap_3_3,Grap_3_4,nrow = 1, ncol =4, labels = c("Ingresos","Retiros","Suspención T.", "Vacacioes"))

Dependientes_total%>%
  select(Mes,var_anual_ingresos19,var_anual_ingresos20,var_anual_ingresos21,
         var_anual_retiro19,var_anual_retiro20,var_anual_retiro21,
         var_anual_suspencion19,var_anual_suspencion20,var_anual_suspencion21,
         var_anual_vacaciones19,var_anual_vacaciones20,var_anual_vacaciones21)%>%
  kbl(caption = "Variaciones anuales de novedades de ingreso, retiro, suspension temporales y vacaciones", align = "lcccccccccccc", 
      col.names = c("Mes","2019","2020","2021","2019","2020","2021","2019","2020","2021","2019","2020","2021"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  column_spec(column = 7,border_right  = TRUE)%>%
  column_spec(column = 10,border_right  = TRUE)%>%
  row_spec(row = 0, bold = TRUE)%>%#, color = "white", background = "#00BFFF",font_size = "large")
  add_header_above(c(" " = 1,"Ingresos" = 3,"Retiros" = 3,"Suspensiones temporales" = 3,"Vacaciones" = 3))

Dependientes_total%>%
  select(Mes,var_mensual_ingresos19,var_mensual_ingresos20,var_mensual_ingresos21,
         var_mensual_retiro19,var_mensual_retiro20,var_mensual_retiro21,
         var_mensual_suspencion19,var_mensual_suspencion20,var_mensual_suspencion21,
         var_mensual_vacaciones19,var_mensual_vacaciones20,var_mensual_vacaciones21)%>%
  kbl(caption = "Variaciones anuales de novedades de ingreso, retiro, suspension temporales y vacaciones", align = "lcccccccccccc", 
      col.names = c("Mes","2019","2020","2021","2019","2020","2021","2019","2020","2021","2019","2020","2021"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  column_spec(column = 7,border_right  = TRUE)%>%
  column_spec(column = 10,border_right  = TRUE)%>%
  row_spec(row = 0, bold = TRUE)%>%#, color = "white", background = "#00BFFF",font_size = "large")
  add_header_above(c(" " = 1,"Ingresos" = 3,"Retiros" = 3,"Suspensiones temporales" = 3,"Vacaciones" = 3))

```

### Independientes

Para el periodo de Diciembre 2021 las novedades de ingreso y retiro fueron de `r formatC(Independientes[Independientes$YEAR == 2021 & Independientes$MONTH == 12,"Ingreso"], format = "f", big.mark = ".", decimal.mark = ",", digits = 0)` y `r formatC(Independientes[Independientes$YEAR == 2021 & Independientes$MONTH == 12,"Retiro"], format = "f", big.mark = ".", decimal.mark = ",", digits = 0)` respectivamente con variaciones mensuales de `r formatC(Independientes[Independientes$YEAR == 2021 & Independientes$MONTH == 12,"var_mensual_ingreso"] * 100, format = "f", big.mark = ".", decimal.mark = ",", digits = 1)`% y `r formatC(Independientes[Independientes$YEAR == 2021 & Independientes$MONTH == 12,"var_mensual_retiro"]*100, format = "f", big.mark = ".", decimal.mark = ",", digits = 1)`%.
 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 5.5, fig.width = 12}
Grap_3_1<-ggplot(data = Independientes[Independientes$YEAR>=2019,], 
  mapping = aes(x = MONTH, y = Por_ingreso*100, fill = paste0(YEAR,".")))+coord_flip()+scale_fill_brewer()+
  geom_bar(stat = "identity" , position = "dodge")+labs(fill = "Años")+ylab("%")+theme_minimal()+theme(legend.position = "bottom")+
  scale_x_continuous("Meses",breaks = c(1:12),labels = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"))+geom_text(aes(label =  round(Por_ingreso*100,1)),position = position_dodge(width = 0.9), size = 2.5)

Grap_3_2<-ggplot(data = Independientes[Independientes$YEAR>=2019,], 
  mapping = aes(x = MONTH, y = Por_retiro*100, fill = paste0(YEAR,".")))+coord_flip()+scale_fill_brewer()+
  geom_bar(stat = "identity" , position = "dodge")+labs(fill = "Años")+ylab("%")+theme_minimal()+theme(legend.position = "bottom")+
  scale_x_continuous("Meses",breaks = c(1:12),labels = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"))+geom_text(aes(label =  round(Por_retiro*100,1)),position = position_dodge(width = 0.9), size = 2.5)

ggarrange(Grap_3_1,Grap_3_2,nrow = 1, ncol =2, labels = c("Ingresos","Retiros"))

Independientes_total<-data.frame(Mes = c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"),
                               var_anual_ingresos19 = paste0(formatC(Independientes[Independientes$YEAR == 2019,"var_anual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_anual_retiro19 = paste0(formatC(Independientes[Independientes$YEAR == 2019,"var_anual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_anual_suspencion19 = paste0(formatC(Independientes[Independientes$YEAR == 2019,"var_anual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_anual_vacaciones19 = paste0(formatC(Independientes[Independientes$YEAR == 2019,"var_anual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_ingresos19 = paste0(formatC(Independientes[Independientes$YEAR == 2019,"var_mensual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_retiro19 = paste0(formatC(Independientes[Independientes$YEAR == 2019,"var_mensual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_suspencion19 = paste0(formatC(Independientes[Independientes$YEAR == 2019,"var_mensual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_vacaciones19 = paste0(formatC(Independientes[Independientes$YEAR == 2019,"var_mensual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),
                               var_anual_ingresos20 = paste0(formatC(Independientes[Independientes$YEAR == 2020,"var_anual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_anual_retiro20 = paste0(formatC(Independientes[Independientes$YEAR == 2020,"var_anual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_anual_suspencion20 = paste0(formatC(Independientes[Independientes$YEAR == 2020,"var_anual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_anual_vacaciones20 = paste0(formatC(Independientes[Independientes$YEAR == 2020,"var_anual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_ingresos20 = paste0(formatC(Independientes[Independientes$YEAR == 2020,"var_mensual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_retiro20 = paste0(formatC(Independientes[Independientes$YEAR == 2020,"var_mensual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_suspencion20 = paste0(formatC(Independientes[Independientes$YEAR == 2020,"var_mensual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_vacaciones20 = paste0(formatC(Independientes[Independientes$YEAR == 2020,"var_mensual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),
                               var_anual_ingresos21 = paste0(formatC(Independientes[Independientes$YEAR == 2021,"var_anual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_anual_retiro21 = paste0(formatC(Independientes[Independientes$YEAR == 2021,"var_anual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_anual_suspencion21 = paste0(formatC(Independientes[Independientes$YEAR == 2021,"var_anual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_anual_vacaciones21 = paste0(formatC(Independientes[Independientes$YEAR == 2021,"var_anual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_ingresos21 = paste0(formatC(Independientes[Independientes$YEAR == 2021,"var_mensual_ingreso"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_retiro21 = paste0(formatC(Independientes[Independientes$YEAR == 2021,"var_mensual_retiro"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_suspencion21 = paste0(formatC(Independientes[Independientes$YEAR == 2021,"var_mensual_suspension"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"),                    
                               var_mensual_vacaciones21 = paste0(formatC(Independientes[Independientes$YEAR == 2021,"var_mensual_vacaciones"]*100, format = "f",digits = 1,big.mark = ".", decimal.mark = ","),"%"))


Independientes_total%>%
  select(Mes,var_anual_ingresos19,var_anual_ingresos20,var_anual_ingresos21,
         var_anual_retiro19,var_anual_retiro20,var_anual_retiro21)%>%
  kbl(caption = "Variaciones anuales de novedades de ingreso y retiro", align = "lcccccc", 
      col.names = c("Mes","2019","2020","2021","2019","2020","2021"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  row_spec(row = 0, bold = TRUE)%>%#, color = "white", background = "#00BFFF",font_size = "large")
  add_header_above(c(" " = 1,"Ingresos" = 3,"Retiros" = 3))

Independientes_total%>%
  select(Mes,var_mensual_ingresos19,var_mensual_ingresos20,var_mensual_ingresos21,
         var_mensual_retiro19,var_mensual_retiro20,var_mensual_retiro21)%>%
  kbl(caption = "Variaciones anuales de novedades de ingreso, retiro, suspension temporales y vacaciones", align = "lcccccccccccc", 
      col.names = c("Mes","2019","2020","2021","2019","2020","2021"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  row_spec(row = 0, bold = TRUE)%>%#, color = "white", background = "#00BFFF",font_size = "large")
  add_header_above(c(" " = 1,"Ingresos" = 3,"Retiros" = 3))
```
# Seguimiento longitudinal 

## Sector privado

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 4.5, fig.width = 12}
setwd("D:/Nuevos_Insumos_IMC/Matrices de transicion/")

panel<-function(tabla){
  Matriz<-read.csv2(tabla,dec = ".")
  Entran_privados<-Matriz[is.na(Matriz$Rango_IBC_pre) & (!is.na(Matriz$Rango_IBC_pos) & Matriz$Tipologia_pos == "Dep_sec_priv"), ]
  Permanecen_privados<-Matriz[(!is.na(Matriz$Rango_IBC_pre) & Matriz$Tipologia_pre == "Dep_sec_priv" ) & (!is.na(Matriz$Rango_IBC_pos) & Matriz$Tipologia_pos == "Dep_sec_priv"), ]
  salen_privados<-Matriz[((!is.na(Matriz$Rango_IBC_pre) & Matriz$Tipologia_pre == "Dep_sec_priv")) & Matriz$Tipologia_pos != "Dep_sec_priv", ]
  
  res_entran<-data.frame(Entran_privados%>%group_by(Rango_IBC_pos)%>%summarise(Privados_entran = sum(Total_relaciones_laborales, na.rm = TRUE)))
  res_permanecen<-data.frame(Permanecen_privados%>%group_by(Rango_IBC_pos)%>%summarise(Privados_permanecen = sum(Total_relaciones_laborales, na.rm = TRUE)))
  res_salen<-data.frame(salen_privados%>%group_by(Rango_IBC_pre)%>%summarise(Privados_salen = sum(Total_relaciones_laborales, na.rm = TRUE), Privados_salen_retiro = sum(retiro_Max_pre_Sum, na.rm = TRUE)))
  matriz_salida <- merge(res_entran,res_permanecen, by = "Rango_IBC_pos", all =TRUE)
  matriz_salida <- merge(matriz_salida,res_salen, by.x = "Rango_IBC_pos", by.y = "Rango_IBC_pre", all =TRUE)
  matriz_salida$Privados_salen_NO_retiro <- matriz_salida$Privados_salen-matriz_salida$Privados_salen_retiro
  
  matriz_salida$Rango_agrupa<-rep(0,nrow(matriz_salida))
  matriz_salida[matriz_salida$Rango_IBC_pos <= 1 ,"Rango_agrupa"] <- rep(1,nrow(matriz_salida[matriz_salida$Rango_IBC_pos <= 1,]))
  matriz_salida[matriz_salida$Rango_IBC_pos %in% c(1.5,2) ,"Rango_agrupa"] <- rep(2,nrow(matriz_salida[matriz_salida$Rango_IBC_pos %in% c(1.5,2),]))
  matriz_salida[matriz_salida$Rango_IBC_pos %in% c(2.5,3) ,"Rango_agrupa"] <- rep(3,nrow(matriz_salida[matriz_salida$Rango_IBC_pos %in% c(2.5,3),]))
  matriz_salida[matriz_salida$Rango_IBC_pos %in% c(3.5,4) ,"Rango_agrupa"] <- rep(4,nrow(matriz_salida[matriz_salida$Rango_IBC_pos %in% c(3.5,4),]))
  matriz_salida[matriz_salida$Rango_IBC_pos %in% c(4.5,5) ,"Rango_agrupa"] <- rep(5,nrow(matriz_salida[matriz_salida$Rango_IBC_pos %in% c(4.5,5),]))
  matriz_salida[matriz_salida$Rango_IBC_pos > 5 ,"Rango_agrupa"] <- rep(6,nrow(matriz_salida[matriz_salida$Rango_IBC_pos> 5,]))

  matriz_salida<-data.frame(matriz_salida%>%group_by(Rango_agrupa)%>%summarise(Privados_entran = sum(Privados_entran,na.rm=TRUE),
          Privados_permanecen = sum(Privados_permanecen, na.rm =TRUE), Privados_salen = sum(Privados_salen, na.rm =TRUE), Privados_salen_retiro = sum(Privados_salen_retiro, na.rm =TRUE),Privados_salen_NO_retiro = sum(Privados_salen_NO_retiro, na.rm =TRUE) ))
  matriz_salida_tot<-data.frame(matriz_salida%>%summarise(Privados_entran = sum(Privados_entran,na.rm=TRUE),
          Privados_permanecen = sum(Privados_permanecen, na.rm =TRUE), Privados_salen = sum(Privados_salen, na.rm =TRUE), Privados_salen_retiro = sum(Privados_salen_retiro, na.rm =TRUE),Privados_salen_NO_retiro = sum(Privados_salen_NO_retiro, na.rm =TRUE) ))
  matriz_salida_tot$Rango_agrupa<-"Total"
  matriz_salida<-rbind(matriz_salida,matriz_salida_tot)
  matriz_salida$Por_entran<-matriz_salida$Privados_entran/(matriz_salida$Privados_entran+matriz_salida$Privados_permanecen)
  matriz_salida$Por_salen<-matriz_salida$Privados_salen/(matriz_salida$Privados_salen +matriz_salida$Privados_permanecen)
  
  matriz_salida<-matriz_salida[order(matriz_salida$Rango_agrupa ),]
  matriz_salida$Rango_agrupa_2<-c("<=1SMMLV","1-2_SMMLV","2-3_SMMLV","3-4_SMMLV","4-5_SMMLV",">5_SMMLV", "Total")
  
  Permanecen_privados$Rango_agrupa_pre<-rep(0,nrow(Permanecen_privados))
  Permanecen_privados$Rango_agrupa_pos<-rep(0,nrow(Permanecen_privados))
  
  Permanecen_privados[Permanecen_privados$Rango_IBC_pre <= 1 ,"Rango_agrupa_pre"] <- rep(1,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pre <= 1,]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pre %in% c(1.5,2) ,"Rango_agrupa_pre"] <- rep(2,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pre %in% c(1.5,2),]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pre %in% c(2.5,3) ,"Rango_agrupa_pre"] <- rep(3,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pre %in% c(2.5,3),]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pre %in% c(3.5,4) ,"Rango_agrupa_pre"] <- rep(4,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pre %in% c(3.5,4),]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pre %in% c(4.5,5) ,"Rango_agrupa_pre"] <- rep(5,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pre %in% c(4.5,5),]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pre > 5 ,"Rango_agrupa_pre"] <- rep(6,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pre> 5,]))
  
  Permanecen_privados[Permanecen_privados$Rango_IBC_pos <= 1 ,"Rango_agrupa_pos"] <- rep(1,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pos <= 1,]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pos %in% c(1.5,2) ,"Rango_agrupa_pos"] <- rep(2,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pos %in% c(1.5,2),]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pos %in% c(2.5,3) ,"Rango_agrupa_pos"] <- rep(3,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pos %in% c(2.5,3),]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pos %in% c(3.5,4) ,"Rango_agrupa_pos"] <- rep(4,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pos %in% c(3.5,4),]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pos %in% c(4.5,5) ,"Rango_agrupa_pos"] <- rep(5,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pos %in% c(4.5,5),]))
  Permanecen_privados[Permanecen_privados$Rango_IBC_pos > 5 ,"Rango_agrupa_pos"] <- rep(6,nrow(Permanecen_privados[Permanecen_privados$Rango_IBC_pos> 5,]))
  
  matriz_transision<-matrix(0,nrow = 6, ncol = 8)
  
  for(i in 1:6){
    for(j in 1:6){
      matriz_transision[i,j]<-(sum(Permanecen_privados[Permanecen_privados$Rango_agrupa_pre == i & Permanecen_privados$Rango_agrupa_pos == j, "Total_relaciones_laborales"])/sum(Permanecen_privados[Permanecen_privados$Rango_agrupa_pre == i , "Total_relaciones_laborales"]))
    }
  }
  for(i in 2:6){matriz_transision[i,7]<-sum(matriz_transision[i,1:(i-1)])}
  for(i in 1:5){matriz_transision[i,8]<-sum(matriz_transision[i,(i+1):6])}

  Entran_independientes<-Matriz[is.na(Matriz$Rango_IBC_pre) & (!is.na(Matriz$Rango_IBC_pos) & Matriz$Tipologia_pos == "Independiente"), ]
  Permanecen_independientes<-Matriz[(!is.na(Matriz$Rango_IBC_pre) & Matriz$Tipologia_pre == "Independiente" ) & (!is.na(Matriz$Rango_IBC_pos) & Matriz$Tipologia_pos == "Independiente"), ]
  salen_independientes<-Matriz[((!is.na(Matriz$Rango_IBC_pre) & Matriz$Tipologia_pre == "Independiente")) & Matriz$Tipologia_pos != "Independiente", ]
  
  res_entran<-data.frame(Entran_independientes%>%group_by(Rango_IBC_pos)%>%summarise(independientes_entran = sum(Total_relaciones_laborales, na.rm = TRUE)))
  res_permanecen<-data.frame(Permanecen_independientes%>%group_by(Rango_IBC_pos)%>%summarise(independientes_permanecen = sum(Total_relaciones_laborales, na.rm = TRUE)))
  res_salen<-data.frame(salen_independientes%>%group_by(Rango_IBC_pre)%>%summarise(independientes_salen = sum(Total_relaciones_laborales, na.rm = TRUE), independientes_salen_retiro = sum(retiro_Max_pre_Sum, na.rm = TRUE)))
  matriz_salida_ind <- merge(res_entran,res_permanecen, by = "Rango_IBC_pos", all =TRUE)
  matriz_salida_ind <- merge(matriz_salida_ind,res_salen, by.x = "Rango_IBC_pos", by.y = "Rango_IBC_pre", all =TRUE)
  matriz_salida_ind$independientes_salen_NO_retiro <- matriz_salida_ind$independientes_salen-matriz_salida_ind$independientes_salen_retiro
  
  matriz_salida_ind$Rango_agrupa<-rep(0,nrow(matriz_salida_ind))
  matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos <= 1 ,"Rango_agrupa"] <- rep(1,nrow(matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos <= 1,]))
  matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos %in% c(1.5,2) ,"Rango_agrupa"] <- rep(2,nrow(matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos %in% c(1.5,2),]))
  matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos %in% c(2.5,3) ,"Rango_agrupa"] <- rep(3,nrow(matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos %in% c(2.5,3),]))
  matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos %in% c(3.5,4) ,"Rango_agrupa"] <- rep(4,nrow(matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos %in% c(3.5,4),]))
  matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos %in% c(4.5,5) ,"Rango_agrupa"] <- rep(5,nrow(matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos %in% c(4.5,5),]))
  matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos > 5 ,"Rango_agrupa"] <- rep(6,nrow(matriz_salida_ind[matriz_salida_ind$Rango_IBC_pos> 5,]))
  
  matriz_salida_ind<-data.frame(matriz_salida_ind%>%group_by(Rango_agrupa)%>%summarise(independientes_entran = sum(independientes_entran,na.rm=TRUE),
                                                                               independientes_permanecen = sum(independientes_permanecen, na.rm =TRUE), independientes_salen = sum(independientes_salen, na.rm =TRUE), independientes_salen_retiro = sum(independientes_salen_retiro, na.rm =TRUE),independientes_salen_NO_retiro = sum(independientes_salen_NO_retiro, na.rm =TRUE) ))
  matriz_salida_ind_tot<-data.frame(matriz_salida_ind%>%summarise(independientes_entran = sum(independientes_entran,na.rm=TRUE),
                                                          independientes_permanecen = sum(independientes_permanecen, na.rm =TRUE), independientes_salen = sum(independientes_salen, na.rm =TRUE), independientes_salen_retiro = sum(independientes_salen_retiro, na.rm =TRUE),independientes_salen_NO_retiro = sum(independientes_salen_NO_retiro, na.rm =TRUE) ))
  matriz_salida_ind_tot$Rango_agrupa<-"Total"
  matriz_salida_ind<-rbind(matriz_salida_ind,matriz_salida_ind_tot)
  matriz_salida_ind$Por_entran<-matriz_salida_ind$independientes_entran/(matriz_salida_ind$independientes_entran+matriz_salida_ind$independientes_permanecen)
  matriz_salida_ind$Por_salen<-matriz_salida_ind$independientes_salen/(matriz_salida_ind$independientes_salen +matriz_salida_ind$independientes_permanecen)
  
  matriz_salida_ind<-matriz_salida_ind[order(matriz_salida_ind$Rango_agrupa ),]
  matriz_salida_ind$Rango_agrupa_2<-c("<=1SMMLV","1-2_SMMLV","2-3_SMMLV","3-4_SMMLV","4-5_SMMLV",">5_SMMLV", "Total")
  
  Permanecen_independientes$Rango_agrupa_pre<-rep(0,nrow(Permanecen_independientes))
  Permanecen_independientes$Rango_agrupa_pos<-rep(0,nrow(Permanecen_independientes))
  
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre <= 1 ,"Rango_agrupa_pre"] <- rep(1,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre <= 1,]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre %in% c(1.5,2) ,"Rango_agrupa_pre"] <- rep(2,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre %in% c(1.5,2),]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre %in% c(2.5,3) ,"Rango_agrupa_pre"] <- rep(3,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre %in% c(2.5,3),]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre %in% c(3.5,4) ,"Rango_agrupa_pre"] <- rep(4,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre %in% c(3.5,4),]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre %in% c(4.5,5) ,"Rango_agrupa_pre"] <- rep(5,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre %in% c(4.5,5),]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre > 5 ,"Rango_agrupa_pre"] <- rep(6,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pre> 5,]))
  
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos <= 1 ,"Rango_agrupa_pos"] <- rep(1,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos <= 1,]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos %in% c(1.5,2) ,"Rango_agrupa_pos"] <- rep(2,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos %in% c(1.5,2),]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos %in% c(2.5,3) ,"Rango_agrupa_pos"] <- rep(3,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos %in% c(2.5,3),]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos %in% c(3.5,4) ,"Rango_agrupa_pos"] <- rep(4,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos %in% c(3.5,4),]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos %in% c(4.5,5) ,"Rango_agrupa_pos"] <- rep(5,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos %in% c(4.5,5),]))
  Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos > 5 ,"Rango_agrupa_pos"] <- rep(6,nrow(Permanecen_independientes[Permanecen_independientes$Rango_IBC_pos> 5,]))
  
  matriz_transision_ind<-matrix(0,nrow = 6, ncol = 8)
  
  for(i in 1:6){
    for(j in 1:6){
      matriz_transision_ind[i,j]<-(sum(Permanecen_independientes[Permanecen_independientes$Rango_agrupa_pre == i & Permanecen_independientes$Rango_agrupa_pos == j, "Total_relaciones_laborales"])/sum(Permanecen_independientes[Permanecen_independientes$Rango_agrupa_pre == i , "Total_relaciones_laborales"]))
    }
  }
  for(i in 2:6){matriz_transision_ind[i,7]<-sum(matriz_transision_ind[i,1:(i-1)])}
  for(i in 1:5){matriz_transision_ind[i,8]<-sum(matriz_transision_ind[i,(i+1):6])}
  
  salida_panel = list(matriz_dep = matriz_salida, transision_dep = matriz_transision, matriz_ind = matriz_salida_ind, transision_ind = matriz_transision_ind)
  salida_panel
} 


matriz_12_21<-panel("Matriz_12_21.csv");matriz_11_21<-panel("Matriz_11_21.csv");matriz_12_20<-panel("Matriz_12_20.csv");matriz_12_19<-panel("Matriz_12_19.csv");matriz_12_18<-panel("Matriz_12_18.csv");matriz_10_21<-panel("Matriz_10_21.csv");matriz_9_21<-panel("Matriz_9_21.csv");matriz_8_21<-panel("Matriz_8_21.csv");matriz_7_21<-panel("Matriz_7_21.csv");matriz_11_20<-panel("Matriz_11_20.csv");matriz_10_20<-panel("Matriz_10_20.csv");matriz_9_20<-panel("Matriz_9_20.csv");matriz_8_20<-panel("Matriz_8_20.csv");matriz_7_20<-panel("Matriz_7_20.csv");matriz_11_19<-panel("Matriz_11_19.csv");matriz_10_19<-panel("Matriz_10_19.csv");matriz_9_19<-panel("Matriz_9_19.csv");matriz_8_19<-panel("Matriz_8_19.csv");matriz_7_19<-panel("Matriz_7_19.csv")

```
Para Diciembre de 2021 se encontraron, `r formatC(Dep_sec_priv[Dep_sec_priv$YEAR == 2021 & Dep_sec_priv$MONTH == 12,3],big.mark = ".",decimal.mark = ",",digits = 0,format = "f")` cotizantes del sector privado, con una variación mensual de `r paste0(round((Dep_sec_priv[Dep_sec_priv$YEAR == 2021 & Dep_sec_priv$MONTH == 12,3]-Dep_sec_priv[Dep_sec_priv$YEAR == 2021 & Dep_sec_priv$MONTH == 11,3])/(Dep_sec_priv[Dep_sec_priv$YEAR == 2021 & Dep_sec_priv$MONTH == 11,3])*100,1),"%")` que es inferior a la obtenida en 2020 y 2019 con  `r paste0(round((Dep_sec_priv[Dep_sec_priv$YEAR == 2020 & Dep_sec_priv$MONTH == 12,3]-Dep_sec_priv[Dep_sec_priv$YEAR == 2020 & Dep_sec_priv$MONTH == 11,3])/(Dep_sec_priv[Dep_sec_priv$YEAR == 2019 & Dep_sec_priv$MONTH == 11,3])*100,1),"%")` y `r paste0(round((Dep_sec_priv[Dep_sec_priv$YEAR == 2019 & Dep_sec_priv$MONTH == 12,3]-Dep_sec_priv[Dep_sec_priv$YEAR == 2019 & Dep_sec_priv$MONTH == 11,3])/(Dep_sec_priv[Dep_sec_priv$YEAR == 2019 & Dep_sec_priv$MONTH == 11,3])*100,1),"%")` respectivamente.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 5.5, fig.width = 12}
matriz_12_21$matriz_dep$Privados_entran1<-formatC(matriz_12_21$matriz_dep$Privados_entran,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_dep$Privados_permanecen1<-formatC(matriz_12_21$matriz_dep$Privados_permanecen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_dep$Privados_salen1<-formatC(matriz_12_21$matriz_dep$Privados_salen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_dep$Privados_salen_retiro1<-formatC(matriz_12_21$matriz_dep$Privados_salen_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_dep$Privados_salen_NO_retiro1<-formatC(matriz_12_21$matriz_dep$Privados_salen_NO_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_dep$Por_entran1<-paste0(round(matriz_12_21$matriz_dep$Por_entran*100,2),"%")
matriz_12_21$matriz_dep$Por_salen1<-paste0(round(matriz_12_21$matriz_dep$Por_salen*100,2),"%")
matriz_12_21$matriz_dep%>%
  select(Rango_agrupa_2,Privados_entran1,Privados_permanecen1,Privados_salen1,
         Privados_salen_retiro1,Privados_salen_NO_retiro1,Por_entran1,Por_salen1)%>%
  kbl(caption = "Matriz resumen de la dinamica pareada entre Diciembre y Noviembre de 2021", align = "lccccccc", 
      col.names = c("Mes","Entran","Permanecen","Salen","Salen con Retiro","Salen sin Retiro","Entran (%)","Salen (%)"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  row_spec(row = 6,  underline = TRUE)%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  column_spec(column = 7, color = "white", background = "darkgreen")%>%
  column_spec(column = 8, color = "white", background = "darkred")

matriz_11_21$matriz_dep$Privados_entran1<-formatC(matriz_11_21$matriz_dep$Privados_entran,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_11_21$matriz_dep$Privados_permanecen1<-formatC(matriz_11_21$matriz_dep$Privados_permanecen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_11_21$matriz_dep$Privados_salen1<-formatC(matriz_11_21$matriz_dep$Privados_salen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_11_21$matriz_dep$Privados_salen_retiro1<-formatC(matriz_11_21$matriz_dep$Privados_salen_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_11_21$matriz_dep$Privados_salen_NO_retiro1<-formatC(matriz_11_21$matriz_dep$Privados_salen_NO_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_11_21$matriz_dep$Por_entran1<-paste0(round(matriz_11_21$matriz_dep$Por_entran*100,2),"%")
matriz_11_21$matriz_dep$Por_salen1<-paste0(round(matriz_11_21$matriz_dep$Por_salen*100,2),"%")
matriz_11_21$matriz_dep%>%
  select(Rango_agrupa_2,Privados_entran1,Privados_permanecen1,Privados_salen1,
         Privados_salen_retiro1,Privados_salen_NO_retiro1,Por_entran1,Por_salen1)%>%
  kbl(caption = "Matriz resumen de la dinamica pareada entre Noviembre y Octubre de 2021", align = "lccccccc", 
      col.names = c("Mes","Entran","Permanecen","Salen","Salen con Retiro","Salen sin Retiro","Entran (%)","Salen (%)"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  row_spec(row = 6,  underline = TRUE)%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  column_spec(column = 7, color = "white", background = "darkgreen")%>%
  column_spec(column = 8, color = "white", background = "darkred")
```

Porcentaje de relaciones laborales que aumentan y salen en el ultimo semestre para el 2019, 2020 y 2021. 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 4.5, fig.width = 12}
dinamica_serie<-rbind(matriz_12_21$matriz_dep[matriz_12_21$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_11_21$matriz_dep[matriz_11_21$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_10_21$matriz_dep[matriz_10_21$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_9_21$matriz_dep[matriz_9_21$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_8_21$matriz_dep[matriz_8_21$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_7_21$matriz_dep[matriz_7_21$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_12_20$matriz_dep[matriz_12_20$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_11_20$matriz_dep[matriz_11_20$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_10_20$matriz_dep[matriz_10_20$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_9_20$matriz_dep[matriz_9_20$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_8_20$matriz_dep[matriz_8_20$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_7_20$matriz_dep[matriz_7_20$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_12_19$matriz_dep[matriz_12_19$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_11_19$matriz_dep[matriz_11_19$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_10_19$matriz_dep[matriz_10_19$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_9_19$matriz_dep[matriz_9_19$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_8_19$matriz_dep[matriz_8_19$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)],
                    matriz_7_19$matriz_dep[matriz_7_19$matriz_dep$Rango_agrupa_2 == "Total",c(7,8)])

dinamica_serie$year = rep(c("2021","2020","2019"),c(6,6,6))
dinamica_serie$month = rep(c(12,11,10,9,8,7),3)
entradas = ggplot(data = dinamica_serie, aes(x = month, y = Por_entran*100, fill = year))+scale_fill_manual(values=c("cyan1","cyan3","cyan4"))+theme_minimal()+labs(title = "Porcentaje de entradas del sector privado", subtitle = "Ultimo semestre en 2019, 2020 y 2021")+
  geom_bar(stat = "identity", position = "dodge")+scale_x_continuous("Meses",breaks = c(7:12),labels = c("Jul","Ago","Sep","Oct","Nov","Dic"))+ylab("%")
salidas = ggplot(data = dinamica_serie, aes(x = month, y = Por_salen, fill = year))+scale_fill_manual(values=c("khaki2","khaki3","khaki4"))+theme_minimal()+labs(title = "Porcentaje de salidas del sector privado", subtitle = "Ultimo semestre en 2019, 2020 y 2021")+
  geom_bar(stat = "identity", position = "dodge")+scale_x_continuous("Meses",breaks = c(7:12),labels = c("Jul","Ago","Sep","Oct","Nov","Dic"))+ylab("%")
ggarrange(entradas,salidas,nrow = 1, ncol =2)

matriz_12_20$matriz_dep$Privados_entran1<-formatC(matriz_12_20$matriz_dep$Privados_entran,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_dep$Privados_permanecen1<-formatC(matriz_12_20$matriz_dep$Privados_permanecen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_dep$Privados_salen1<-formatC(matriz_12_20$matriz_dep$Privados_salen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_dep$Privados_salen_retiro1<-formatC(matriz_12_20$matriz_dep$Privados_salen_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_dep$Privados_salen_NO_retiro1<-formatC(matriz_12_20$matriz_dep$Privados_salen_NO_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_dep$Por_entran1<-paste0(round(matriz_12_20$matriz_dep$Por_entran*100,2),"%")
matriz_12_20$matriz_dep$Por_salen1<-paste0(round(matriz_12_20$matriz_dep$Por_salen*100,2),"%")
matriz_12_20$matriz_dep%>%
  select(Rango_agrupa_2,Privados_entran1,Privados_permanecen1,Privados_salen1,
         Privados_salen_retiro1,Privados_salen_NO_retiro1,Por_entran1,Por_salen1)%>%
  kbl(caption = "Matriz resumen de la dinamica pareada entre Diciembre y Noviembre de 2020", align = "lccccccc", 
      col.names = c("Mes","Entran","Permanecen","Salen","Salen con Retiro","Salen sin Retiro","Entran (%)","Salen (%)"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  row_spec(row = 6,  underline = TRUE)%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  column_spec(column = 7, color = "white", background = "darkgreen")%>%
  column_spec(column = 8, color = "white", background = "darkred")

matriz_12_19$matriz_dep$Privados_entran1<-formatC(matriz_12_19$matriz_dep$Privados_entran,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_dep$Privados_permanecen1<-formatC(matriz_12_19$matriz_dep$Privados_permanecen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_dep$Privados_salen1<-formatC(matriz_12_19$matriz_dep$Privados_salen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_dep$Privados_salen_retiro1<-formatC(matriz_12_19$matriz_dep$Privados_salen_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_dep$Privados_salen_NO_retiro1<-formatC(matriz_12_19$matriz_dep$Privados_salen_NO_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_dep$Por_entran1<-paste0(round(matriz_12_19$matriz_dep$Por_entran*100,2),"%")
matriz_12_19$matriz_dep$Por_salen1<-paste0(round(matriz_12_19$matriz_dep$Por_salen*100,2),"%")
matriz_12_19$matriz_dep%>%
  select(Rango_agrupa_2,Privados_entran1,Privados_permanecen1,Privados_salen1,
         Privados_salen_retiro1,Privados_salen_NO_retiro1,Por_entran1,Por_salen1)%>%
  kbl(caption = "Matriz resumen de la dinamica pareada entre Diciembre y Noviembre de 2019", align = "lccccccc", 
      col.names = c("Mes","Entran","Permanecen","Salen","Salen con Retiro","Salen sin Retiro","Entran (%)","Salen (%)"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  row_spec(row = 6,  underline = TRUE)%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  column_spec(column = 7, color = "white", background = "darkgreen")%>%
  column_spec(column = 8, color = "white", background = "darkred")

```

En diciembre de 2021 aumentaron las salidas en  `r matriz_12_21$matriz_dep[matriz_12_21$matriz_dep$Rango_agrupa == "Total","Privados_salen"] - matriz_12_20$matriz_dep[matriz_12_21$matriz_dep$Rango_agrupa == "Total","Privados_salen"]` asi como las entradas en 

De las relaciones laborales que permanecieron, el `r paste0(round(mean(matriz_12_21$transision_dep[,7])*100,2),"%")`,`r paste0(round(mean(matriz_12_21$transision_dep[,8])*100,2),"%")` y `r paste0(round(mean(diag(matriz_12_21$transision_dep[,1:6]))*100,2),"%")` disminuyen, aumentan y permanecen en promedio el rango salarial para Diciembre de 2021. En 2020 y en 2019 las disminuciones, aumentos y permanencias se presentan en la siguientes magnitudes `r paste0(round(mean(matriz_12_20$transision_dep[,7])*100,2),"%")`,`r paste0(round(mean(matriz_12_20$transision_dep[,8])*100,2),"%")` y `r paste0(round(mean(diag(matriz_12_20$transision_dep[,1:6]))*100,2),"%")`, y `r paste0(round(mean(matriz_12_19$transision_dep[,7])*100,2),"%")`,`r paste0(round(mean(matriz_12_19$transision_dep[,8])*100,2),"%")` y `r paste0(round(mean(diag(matriz_12_19$transision_dep[,1:6]))*100,2),"%")`.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 4.5, fig.width = 12}
MT12_21_dep<-data.frame(paste0(round(matriz_12_21$transision_dep[,1]*100,2),"%"),paste0(round(matriz_12_21$transision_dep[,2]*100,2),"%"),paste0(round(matriz_12_21$transision_dep[,3]*100,2),"%"),paste0(round(matriz_12_21$transision_dep[,4]*100,2),"%"),paste0(round(matriz_12_21$transision_dep[,5]*100,2),"%"),paste0(round(matriz_12_21$transision_dep[,6]*100,2),"%"),paste0(round(matriz_12_21$transision_dep[,7]*100,2),"%"),paste0(round(matriz_12_21$transision_dep[,8]*100,2),"%"));colnames(MT12_21_dep)<-c("<=1SMMLV","1-2SMMLV","2-3SMMLV","3-4SMMLV","4-5SMMLV",">5SMMLV","Incrementan","Disminuyen")
MT12_21_dep$rownames_1<-c("<=1SMMLV","1-2SMMLV","2-3SMMLV","3-4SMMLV","4-5SMMLV",">5SMMLV")
MT12_21_dep%>%
  select('<=1SMMLV','1-2SMMLV','2-3SMMLV','3-4SMMLV','4-5SMMLV','>5SMMLV',Incrementan,Disminuyen)%>%
  kbl(caption = "Matriz de trancisión entre Noviembre y Diciembre de 2021", align = "lcccccccc", 
      col.names = c('<=1SMMLV','1-2SMMLV','2-3SMMLV','3-4SMMLV','4-5SMMLV','>5SMMLV','Disminuyen %','Incrementan %'))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  column_spec(column = 6,border_right  = TRUE)

MT12_20_dep<-data.frame(paste0(round(matriz_12_20$transision_dep[,1]*100,2),"%"),paste0(round(matriz_12_20$transision_dep[,2]*100,2),"%"),paste0(round(matriz_12_20$transision_dep[,3]*100,2),"%"),paste0(round(matriz_12_20$transision_dep[,4]*100,2),"%"),paste0(round(matriz_12_20$transision_dep[,5]*100,2),"%"),paste0(round(matriz_12_20$transision_dep[,6]*100,2),"%"),paste0(round(matriz_12_20$transision_dep[,7]*100,2),"%"),paste0(round(matriz_12_20$transision_dep[,8]*100,2),"%"));colnames(MT12_20_dep)<-c("<=1SMMLV","1-2SMMLV","2-3SMMLV","3-4SMMLV","4-5SMMLV",">5SMMLV","Incrementan","Disminuyen")
MT12_20_dep$rownames_1<-c("<=1SMMLV","1-2SMMLV","2-3SMMLV","3-4SMMLV","4-5SMMLV",">5SMMLV")
MT12_20_dep%>%
  select('<=1SMMLV','1-2SMMLV','2-3SMMLV','3-4SMMLV','4-5SMMLV','>5SMMLV',Incrementan,Disminuyen)%>%
  kbl(caption = "Matriz de trancisión entre Noviembre y Diciembre de 2020", align = "lcccccccc", 
      col.names = c('<=1SMMLV','1-2SMMLV','2-3SMMLV','3-4SMMLV','4-5SMMLV','>5SMMLV','Disminuyen %','Incrementan %'))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  column_spec(column = 6,border_right  = TRUE)

MT12_19_dep<-data.frame(paste0(round(matriz_12_19$transision_dep[,1]*100,2),"%"),paste0(round(matriz_12_19$transision_dep[,2]*100,2),"%"),paste0(round(matriz_12_19$transision_dep[,3]*100,2),"%"),paste0(round(matriz_12_19$transision_dep[,4]*100,2),"%"),paste0(round(matriz_12_19$transision_dep[,5]*100,2),"%"),paste0(round(matriz_12_19$transision_dep[,6]*100,2),"%"),paste0(round(matriz_12_19$transision_dep[,7]*100,2),"%"),paste0(round(matriz_12_19$transision_dep[,8]*100,2),"%"));colnames(MT12_19_dep)<-c("<=1SMMLV","1-2SMMLV","2-3SMMLV","3-4SMMLV","4-5SMMLV",">5SMMLV","Incrementan","Disminuyen")
MT12_19_dep$rownames_1<-c("<=1SMMLV","1-2SMMLV","2-3SMMLV","3-4SMMLV","4-5SMMLV",">5SMMLV")
MT12_19_dep%>%
  select('<=1SMMLV','1-2SMMLV','2-3SMMLV','3-4SMMLV','4-5SMMLV','>5SMMLV',Incrementan,Disminuyen)%>%
  kbl(caption = "Matriz de trancisión entre Noviembre y Diciembre de 2020", align = "lcccccccc", 
      col.names = c('<=1SMMLV','1-2SMMLV','2-3SMMLV','3-4SMMLV','4-5SMMLV','>5SMMLV','Disminuyen %','Incrementan %'))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  column_spec(column = 6,border_right  = TRUE)
```
### Actividad económica

![](D:/Resultados_IMC/Presentaciones/Actividad_economica_secprivado.jpg)

## Independientes

Para Diciembre de 2021 se encontraron `r formatC((matriz_12_21$matriz_ind[7,2]+matriz_12_21$matriz_ind[7,3]),big.mark = ".",decimal.mark = ",",digits = 0,format = "f")` cotizantes del sector privado, con una variación mensual de `r paste0(round(((matriz_12_21$matriz_ind[7,2]+matriz_12_21$matriz_ind[7,3])-(matriz_12_21$matriz_ind[7,4]+matriz_12_21$matriz_ind[7,3]))/((matriz_12_21$matriz_ind[7,4]+matriz_12_21$matriz_ind[7,3]))*100,1),"%")` que es mas alta a la obtenida en 2020 y 2019 con  `r paste0(round(((matriz_12_20$matriz_ind[7,2]+matriz_12_20$matriz_ind[7,3])-(matriz_12_20$matriz_ind[7,4]+matriz_12_20$matriz_ind[7,3]))/((matriz_12_20$matriz_ind[7,4]+matriz_12_20$matriz_ind[7,3]))*100,1),"%")` y `r paste0(round(((matriz_12_19$matriz_ind[7,2]+matriz_12_19$matriz_ind[7,3])-(matriz_12_19$matriz_ind[7,4]+matriz_12_19$matriz_ind[7,3]))/((matriz_12_19$matriz_ind[7,4]+matriz_12_19$matriz_ind[7,3]))*100,1),"%")` respectivamente.


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 4.5, fig.width = 12}
matriz_12_21$matriz_ind$independientes_entran1<-formatC(matriz_12_21$matriz_ind$independientes_entran,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_ind$independientes_permanecen1<-formatC(matriz_12_21$matriz_ind$independientes_permanecen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_ind$independientes_salen1<-formatC(matriz_12_21$matriz_ind$independientes_salen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_ind$independientes_salen_retiro1<-formatC(matriz_12_21$matriz_ind$independientes_salen_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_ind$independientes_salen_NO_retiro1<-formatC(matriz_12_21$matriz_ind$independientes_salen_NO_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_21$matriz_ind$Por_entran1<-paste0(round(matriz_12_21$matriz_ind$Por_entran*100,2),"%")
matriz_12_21$matriz_ind$Por_salen1<-paste0(round(matriz_12_21$matriz_ind$Por_salen*100,2),"%")
matriz_12_21$matriz_ind%>%
  select(Rango_agrupa_2,independientes_entran1,independientes_permanecen1,independientes_salen1,
         independientes_salen_retiro1,independientes_salen_NO_retiro1,Por_entran1,Por_salen1)%>%
  kbl(caption = "Matriz resumen de la dinamica pareada entre Diciembre y Noviembre de 2021", align = "lccccccc", 
      col.names = c("Mes","Entran","Permanecen","Salen","Salen con Retiro","Salen sin Retiro","Entran (%)","Salen (%)"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  row_spec(row = 6,  underline = TRUE)%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  column_spec(column = 7, color = "white", background = "darkgreen")%>%
  column_spec(column = 8, color = "white", background = "darkred")

```

Un aumento de `r formatC((matriz_12_21$matriz_ind[7,4]-matriz_12_21$matriz_ind[7,2]),big.mark = ".",decimal.mark = ",",digits = 0,format = "d")` salidas con relación a las entradas, que es superior a las registradas en 2020 y 2019 con diferencias de `r formatC((matriz_12_20$matriz_ind[7,4]-matriz_12_20$matriz_ind[7,2]),big.mark = ".",decimal.mark = ",",digits = 0,format = "d")` y `r formatC((matriz_12_19$matriz_ind[7,4]-matriz_12_19$matriz_ind[7,2]),big.mark = ".",decimal.mark = ",",digits = 0,format = "d")` pero por debajo de las registradas en 2018 que fueron de `r formatC((matriz_12_18$matriz_ind[7,4]-matriz_12_18$matriz_ind[7,2]),big.mark = ".",decimal.mark = ",",digits = 0,format = "d")`

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", fig.height = 4.5, fig.width = 12}

matriz_12_20$matriz_ind$independientes_entran1<-formatC(matriz_12_20$matriz_ind$independientes_entran,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_ind$independientes_permanecen1<-formatC(matriz_12_20$matriz_ind$independientes_permanecen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_ind$independientes_salen1<-formatC(matriz_12_20$matriz_ind$independientes_salen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_ind$independientes_salen_retiro1<-formatC(matriz_12_20$matriz_ind$independientes_salen_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_ind$independientes_salen_NO_retiro1<-formatC(matriz_12_20$matriz_ind$independientes_salen_NO_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_20$matriz_ind$Por_entran1<-paste0(round(matriz_12_20$matriz_ind$Por_entran*100,2),"%")
matriz_12_20$matriz_ind$Por_salen1<-paste0(round(matriz_12_20$matriz_ind$Por_salen*100,2),"%")
matriz_12_20$matriz_ind%>%
  select(Rango_agrupa_2,independientes_entran1,independientes_permanecen1,independientes_salen1,
         independientes_salen_retiro1,independientes_salen_NO_retiro1,Por_entran1,Por_salen1)%>%
  kbl(caption = "Matriz resumen de la dinamica pareada entre Diciembre y Noviembre de 2020", align = "lccccccc", 
      col.names = c("Mes","Entran","Permanecen","Salen","Salen con Retiro","Salen sin Retiro","Entran (%)","Salen (%)"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  row_spec(row = 6,  underline = TRUE)%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  column_spec(column = 7, color = "white", background = "darkgreen")%>%
  column_spec(column = 8, color = "white", background = "darkred")

matriz_12_19$matriz_ind$independientes_entran1<-formatC(matriz_12_19$matriz_ind$independientes_entran,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_ind$independientes_permanecen1<-formatC(matriz_12_19$matriz_ind$independientes_permanecen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_ind$independientes_salen1<-formatC(matriz_12_19$matriz_ind$independientes_salen,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_ind$independientes_salen_retiro1<-formatC(matriz_12_19$matriz_ind$independientes_salen_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_ind$independientes_salen_NO_retiro1<-formatC(matriz_12_19$matriz_ind$independientes_salen_NO_retiro,big.mark = ".",decimal.mark = ",",digits = 0,format = "f")
matriz_12_19$matriz_ind$Por_entran1<-paste0(round(matriz_12_19$matriz_ind$Por_entran*100,2),"%")
matriz_12_19$matriz_ind$Por_salen1<-paste0(round(matriz_12_19$matriz_ind$Por_salen*100,2),"%")
matriz_12_19$matriz_ind%>%
  select(Rango_agrupa_2,independientes_entran1,independientes_permanecen1,independientes_salen1,
         independientes_salen_retiro1,independientes_salen_NO_retiro1,Por_entran1,Por_salen1)%>%
  kbl(caption = "Matriz resumen de la dinamica pareada entre Diciembre y Noviembre de 2019", align = "lccccccc", 
      col.names = c("Mes","Entran","Permanecen","Salen","Salen con Retiro","Salen sin Retiro","Entran (%)","Salen (%)"))%>%
  kable_classic(full_width = F, html_font = "Calibri")%>%
  row_spec(row = 0, bold = TRUE)%>%
  row_spec(row = 6,  underline = TRUE)%>%
  column_spec(column = 1,border_right  = TRUE)%>%
  column_spec(column = 4,border_right  = TRUE)%>%
  column_spec(column = 7, color = "white", background = "darkgreen")%>%
  column_spec(column = 8, color = "white", background = "darkred")

dinamica_serie_ind<-rbind(matriz_12_21$matriz_ind[matriz_12_21$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_11_21$matriz_ind[matriz_11_21$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_10_21$matriz_ind[matriz_10_21$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_9_21$matriz_ind[matriz_9_21$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_8_21$matriz_ind[matriz_8_21$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_7_21$matriz_ind[matriz_7_21$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_12_20$matriz_ind[matriz_12_20$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_11_20$matriz_ind[matriz_11_20$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_10_20$matriz_ind[matriz_10_20$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_9_20$matriz_ind[matriz_9_20$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_8_20$matriz_ind[matriz_8_20$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_7_20$matriz_ind[matriz_7_20$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_12_19$matriz_ind[matriz_12_19$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_11_19$matriz_ind[matriz_11_19$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_10_19$matriz_ind[matriz_10_19$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_9_19$matriz_ind[matriz_9_19$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_8_19$matriz_ind[matriz_8_19$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)],
                      matriz_7_19$matriz_ind[matriz_7_19$matriz_ind$Rango_agrupa_2 == "Total",c(7,8)])

dinamica_serie_ind$year = rep(c("2021","2020","2019"),c(6,6,6))
dinamica_serie_ind$month = rep(c(12,11,10,9,8,7),3)
entradas = ggplot(data = dinamica_serie_ind, aes(x = month, y = Por_entran*100, fill = year))+scale_fill_manual(values=c("cyan1","cyan3","cyan4"))+theme_minimal()+labs(title = "Porcentaje de entradas de los independientes", subtitle = "Ultimo semestre en 2019, 2020 y 2021")+
  geom_bar(stat = "identity", position = "dodge")+scale_x_continuous("Meses",breaks = c(7:12),labels = c("Jul","Ago","Sep","Oct","Nov","Dic"))+ylab("%")
salidas = ggplot(data = dinamica_serie_ind, aes(x = month, y = Por_salen, fill = year))+scale_fill_manual(values=c("khaki2","khaki3","khaki4"))+theme_minimal()+labs(title = "Porcentaje de salidas de los independientes", subtitle = "Ultimo semestre en 2019, 2020 y 2021")+
  geom_bar(stat = "identity", position = "dodge")+scale_x_continuous("Meses",breaks = c(7:12),labels = c("Jul","Ago","Sep","Oct","Nov","Dic"))+ylab("%")
ggarrange(entradas,salidas,nrow = 1, ncol =2)

```

### Actividad económica

Para Diciembre de 2021 las cotizaciones en el sector privado incre

![](D:/Resultados_IMC/Presentaciones/Actividad_economica_independientes.jpg)

# Monto de cotización

## Dependientes

![](D:/Resultados_IMC/Presentaciones/monto_dependientes.jpg)

## Independientes

![](D:/Resultados_IMC/Presentaciones/monto_independientes.jpg)

![](D:/Resultados_IMC/Presentaciones/gracias.jpg)

